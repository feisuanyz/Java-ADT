### 2. 接口

#### 2.1 新增接口

本节主要介绍如何在项目中新增接口的具体操作方法。

##### 2.1.1 操作步骤

a）在项目管理页面中，选择“接口管理”，系统显示接口管理页面，如图2-1所示：

![2-1](https://www.feisuanyz.com/fsimage/ks-image/ks_5-1_img.png)

##### 图2-1 选择接口管理

b）单击“新增接口模块”，系统显示“新增接口模块”，输入接口模块的信息，如图2-2所示：

![2-2](https://www.feisuanyz.com/fsimage/ks-image/ks_5-2_img.png)

##### 图2-2 新增接口模块

c）单击“确定” --> 系统提示“新增成功”。

d）单击已新增模块后的“+”，选择“新增接口”，如图2-3所示：

![2-3](https://www.feisuanyz.com/fsimage/ks-image/ks_5-3_img.png)

##### 图2-3 新增接口

e）在“新增接口信息 > 基本信息”页面，配置接口的基本信息，如图2-4所示：

![2-4](https://www.feisuanyz.com/fsimage/ks-image/ks_5-4_img.png)

##### 图2-4 配置新增接口的基本信息

f）单击“下一步”。

##### a）当响应码code输入000000，返回信息“msg”代表成功。

##### b）当响应码code输入999999，返回信息“msg”代表失败。

![2-7](https://www.feisuanyz.com/fsimage/ks-image/ks_5-7_img.png)

##### 图2-7 配置新增接口的输出结果内容

j）单击“新增入口参数”，配置接口的入口参数信息，如图2-8所示：

![2-8](https://www.feisuanyz.com/fsimage/ks-image/ks_5-8_img.png)

##### 图2-8 配置新增接口的入口参数信息

k）在“输出结果 > 选择数据”页面，选择输出结果的“成功”项，如图2-9所示：

![2-9](https://www.feisuanyz.com/fsimage/ks-image/ks_5-9_img.png)

##### 图2-9 选择输出结果的成功项

l）在“输出结果 > 选择数据”页面，选择输出结果的“成功”项，如图2-9所示：

![2-9](https://www.feisuanyz.com/fsimage/ks-image/ks_5-9_img.png)

##### 图2-9 选择输出结果的成功项

m）完成新增接口的入口参数的信息配置，如图2-10所示：


g）在“新增接口信息 > 基本信息”页面，配置接口的基本信息，如图2-5所示：

![2-5](https://www.feisuanyz.com/fsimage/ks-image/ks_5-5_img.png)

##### 图2-5 配置新增接口的入口参数

h）单击“输出结果类型配置 > 输出结果项”，配置接口输出结果的信息，如图2-6所示：

##### 说明：
##### 在接口输出结果类型配置中至少要包括“响应吗”、“返回信息”和“返回数据”这三种配置项，则需要按照以下要求进行配置，假设使用：code代表“响应吗”、msg代表“返回信息”、data代表“返回数据”；code、msg类型选择String，data类型选择Object；data返回业务数据的“动态获取值”选择为是。

![2-6](https://www.feisuanyz.com/fsimage/ks-image/ks_5-6_img.png)

##### 图2-6 配置新增接口的输出结果项

i）单击“输出结果类型配置 > 输出结果内容”，配置接口输出结果的信息，如图2-7所示：

##### 说明：

![2-10](https://www.feisuanyz.com/fsimage/ks-image/ks_5-10_img.png)

##### 图2-10 配置新增接口的入口参数

n）单击“提交，进入“模型”页面”，如图2-11所示：

![2-11](https://www.feisuanyz.com/fsimage/ks-image/ks_5-11_img.png)

##### 图2-11 新增接口信息的模型页面

o）单击“进入模型编辑”，系统显示“窗体视图”页面，选择“组件列表 > 工具 > 输出结果”，拖拽“输出结果”组件至视图区域，如图2-12所示：

![2-12](https://www.feisuanyz.com/fsimage/ks-image/ks_5-12_img.png)

##### 图2-12 窗体视图

p）连接组件的流程图，如图2-13所示：

![2-13](https://www.feisuanyz.com/fsimage/ks-image/ks_5-13_img.png)

##### 图2-13 连接组件流程图

q）选中流程图中的输出结果组件，在右侧输出结果中配置“响应结果”，如图2-14所示：

![2-14](https://www.feisuanyz.com/fsimage/ks-image/ks_5-14_img.png)

##### 图2-14 配置输出结果的响应结果

r）单击“确认”，完成配置响应结果。

s）选中流程图中的输出结果组件，在右侧输出结果中配置“输出项值”，如图2-15、图2-16、图2-17、图2-18所示：

![2-15](https://www.feisuanyz.com/fsimage/ks-image/ks_5-15_img.png)

##### 图2-15 配置输出结果的输出项值

![2-16](https://www.feisuanyz.com/fsimage/ks-image/ks_5-16_img.png)

##### 图2-16 选择值类型

![2-17](https://www.feisuanyz.com/fsimage/ks-image/ks_5-17_img.png)

##### 图2-17 选择流程变量

![2-18](https://www.feisuanyz.com/fsimage/ks-image/ks_5-18_img.png)

##### 图2-18 选择接口根参数

t）单击“确定”，完成配置输出项值，如图2-19所示：

![2-19](https://www.feisuanyz.com/fsimage/ks-image/ks_5-19_img.png)

##### 图2-19 配置输出项值

u）单击“确定”，完成组件配置，如图2-20所示，单击“保存并退出”：

![2-20](https://www.feisuanyz.com/fsimage/ks-image/ks_5-20_img.png)

##### 图2-20 保存组件配置

v）单击“提交”，完成接口配置，如图2-21所示：

![2-21](https://www.feisuanyz.com/fsimage/ks-image/ks_5-21_img.png)

##### 图2-21 提交接口配置

w）单击“提交”后的“...”，选择“发布接口”，如图2-22所示：

![2-22](https://www.feisuanyz.com/fsimage/ks-image/ks_5-22_img.png)

##### 图2-22 发布接口

x）单击“提交”后的“...”，选择“测试用例”，如图2-23所示：

![2-23](https://www.feisuanyz.com/fsimage/ks-image/ks_5-23_img.png)

##### 图2-23 测试接口用例

y）单击“编辑”，配置Body参数信息，如图2-24所示：

![2-24](https://www.feisuanyz.com/fsimage/ks-image/ks_5-24_img.png)

##### 图2-24 配置测试用例参数

z）单击“保存”保存配置，单击“执行”执行测试用例并查看执行输出结果，如图2-25所示：

![2-25](https://www.feisuanyz.com/fsimage/ks-image/ks_5-25_img.png)

##### 图2-25 执行测试用例并查看输出结果

#### 2.2 生成接口

本节主要介绍如何通过全自动开发平台自动生成接口。

##### 前提条件

a）您已经成功连接数据库。

b）您已经成功连接分布式中间件资源。

##### 2.2.1 操作步骤

a）在项目管理页面中选择“接口生成器”，系统显示“接口生成器”页面，如图2-26所示：

![2-26](https://www.feisuanyz.com/fsimage/ks-image/ks_14-00_img.png)

##### 图2-26 选择接口生成器

b）选中数据库，如图2-27所示，单击“下一步”：

![2-27](https://www.feisuanyz.com/fsimage/ks-image/ks_14-01_img.png)

##### 图2-27 选择数据库

c）勾选需要生成的SQL信息的表，如图2-28所示，单击“下一步”：

![2-28](https://www.feisuanyz.com/fsimage/ks-image/ks_14-2_img.png)

##### 图2-28 选择数据库表

d）勾选全部，选择接口模块、SQL组和SQL模块，如图2-29所示：

![2-29](https://www.feisuanyz.com/fsimage/ks-image/ks_14-3_img.png)

##### 图2-29 选择勾选全部

e）单击“生成接口”，如图2-30所示：

![2-30](https://www.feisuanyz.com/fsimage/ks-image/ks_14-4_img.png)

##### 图2-30 生成接口

f）查看生成的接口，如图2-31所示：

![2-31](https://www.feisuanyz.com/fsimage/ks-image/ks_14-5_img.png)

##### 图2-31 查看生成接口

#### 2.3 生成接口

本节主要介绍如何对已经开发完成的接口进行测试。

##### 2.3.1 操作步骤

a）在项目管理页面中选择“接口管理”，系统显示“接口管理”页面，如图2-26所示：

![2-26](https://www.feisuanyz.com/fsimage/ks-image/ks_9-1_img.png)

##### 图2-26 选择接口管理

b）在左侧选择接口模块，并展开接口模块列表，如图2-27所示：

![2-27](https://www.feisuanyz.com/fsimage/ks-image/ks_9-2_img.png)

##### 图2-27 展开接口模块列表

c）选中接口并双击，进入接口模型页面，如图2-28所示：

![2-28](https://www.feisuanyz.com/fsimage/ks-image/ks_9-3_img.png)

##### 图2-28 进入接口模型页面

d）选择“提交”后的“••• > 测试用例”如图9-4所示，进入测试用例页面，如图2-29所示：

![2-29](https://www.feisuanyz.com/fsimage/ks-image/ks_9-4_img.png)

##### 图2-29 选择测试用例

e）选择“提交”后的“••• > 测试用例”如图2-29所示，进入测试用例页面，如图2-30所示：

![2-29](https://www.feisuanyz.com/fsimage/ks-image/ks_9-4_img.png)

##### 图2-29 选择测试用例

![2-30](https://www.feisuanyz.com/fsimage/ks-image/ks_9-5_img.png)

##### 图2-30 测试用例页面

f）勾选测试用例，如图2-31所示：

![2-31](https://www.feisuanyz.com/fsimage/ks-image/ks_9-6_img.png)

##### 图2-31 勾选测试用例

g）单击“执行”，测试接口执行结果，如图2-32所示：

![2-32](https://www.feisuanyz.com/fsimage/ks-image/ks_9-7_img.png)

##### 图2-32 测试结果

#### 2.4 快速创建接口

系统提供该功能，您可以通过导入swagger接口文档快速创建接口，无需手动创建接口模块和接口入参。当导入成功后，直接画流程图即可，若出现特殊情况无法解析参数或接口时，则需进行手动修改。本节将为您介绍快速创建接口的具体操作步骤。

##### 2.4.1 操作步骤

a）进入平台功能模块界面，选择接口管理，系统显示接口管理页面，如图2-33所示：

![2-33](https://www.feisuanyz.com/fsimage/zc-image/czzn_16_2_4_1.png)

##### 图2-33 选择接口管理

b）单击“新增接口模块”旁的三个点按钮，选择“导入接口文档快速创建接口”，如图2-34所示：

![2-34](https://www.feisuanyz.com/fsimage/zc-image/czzn_16_2_4_2.png)

##### 图2-34 选择“导入接口文档快速创建接口”

c）系统显示“导入接口文档快速创建接口”页面，如图2-35所示：

![2-35](https://www.feisuanyz.com/fsimage/zc-image/czzn_16_2_4_3.png)

##### 图2-35 导入接口文档快速创建接口页面

d）选择并上传swagger格式的接口文档，单击“导入”，如图2-36所示：

![2-36](https://www.feisuanyz.com/fsimage/zc-image/czzn_16_2_4_4.png)

##### 图2-36 上传swagger格式的接口文档

##### 注意：在上传文件时，请注意页面黄色区域的“导入提示”。

e）稍等片刻，您可以看到接口列表下新增了很多接口模块，如图2-37所示：

![2-37](https://www.feisuanyz.com/fsimage/zc-image/czzn_16_2_4_5.png)

##### 图2-37 导入成功

#### 2.5 调用WebSocket协议实现主动推送消息

ebSocket协议是一种在单个TCP连接上进行全双工通信的协议，它允许服务端主动向客户端推送数据，客户端和服务端只需要完成一次握手，两者之间就可以创建持久性的连接并双向传输数据，这使得客户端和服务端之间的数据交换变得更加简单。

全自动开发平台支持WebSocket协议，但需配合客户端通信组件的使用，本节将通过具体实例进行介绍。

#### 注意：若不对客户端通信组件的客户端编号进行选择（即设置为空），便可以实现群发消息，服务器会将所有响应的信息群发给建立关系的客户端。
 
##### 2.5.1 结果展示

a）实例主要是通过服务端主动向客户端推送计数变量值，实现一个倒计时的效果，如图2-38所示：

![2-38](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_8.png)

##### 图2-38 实现倒计时

##### 注意：本案例的实现需要和前端进行联调，具体可参见前端调测-项目接口与前端在线联调。

##### 2.5.2 流程图展示

a）实例主要是通过服务端主动向客户端推送计数变量值，实现一个倒计时的效果，如图2-39所示：

![2-39](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_7.png)

##### 图2-39 流程图

##### 2.5.3 操作步骤

a）为项目添加客户端通信组件加载项，如图2-40所示：

![2-40](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_1.png)

##### 图2-40 添加加载项

b）新增一个接口，接口协议选择WebSocket，如图2-41所示：

![2-41](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_2.png)

##### 图2-41 新增接口

c）配置接口的入口参数，本实例需要添加计数变量a，如图2-42所示：

![2-42](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_9.png)

##### 图2-42 配置入口参数

d）通过拖、拽、拉的方式进行模型编辑（即流程图编辑），需注意关键的组件客户端通信组件，如图2-43所示：

![2-43](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_10.png)

##### 图2-43 进行模型编辑

e）接下来将对组件的具体配置进行展示。

##### e1）计数器组件【录入计数变量、实现逐次递减】：用于引用计数变量，并实现计数变量的逐次递减。计数器组件的循环流程变量选择入口参数计数变量a，操作符选择递减，如图2-44、图2-45、图2-46所示：

![2-44](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_11.png)

##### 图2-44

![2-45](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_13.png)

##### 图2-45

![2-46](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_14.png)

##### 图2-46

##### e2）互斥条件组件【判断计数变量是否大于0】：用于判断计数变量的值是否大于0，若大于0，则通过客户端通信组件主动推送计数变量的值，若小于等于0，则结束程序，两条顺序流的流转条件的设置图2-47、图2-48、图2-49、图2-50、图2-51、图2-52、图2-53、图2-54所示：

![2-47](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_15.png)

##### 图2-47

![2-48](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_16.png)

##### 图2-48

![2-49](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_17.png)

##### 图2-49

![2-50](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_18.png)

##### 图2-50

![2-51](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_26.png)

##### 图2-51

![2-52](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_27.png)

##### 图2-52

##### e3）输出结果组件：用于到计数变量的值小于等于0时，结束程序，将最终结果输出。

![2-53](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_28.png)

##### 图2-53

![2-54](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_29.png)

##### 图2-54

##### e4）单函数组件【休眠：制造等待时间】：用于程序在进行倒计时时，制造倒计时的间隔时间，用到的函数是休眠函数sleep(long arg0)，需传入休眠时间，具体配置如图2-55、图2-56所示：

![2-55](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_19.png)

##### 图2-55

![2-56](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_20.png)

##### 图2-56

##### e5）客户端通信组件【建立连接、主动推送数据】：用于与websocket服务端建立连接，并主动推送计数器变量的数据给客户端。客户端通信组件的具体配置如下图所示，若此处不对客户端编号进行设置，便可以实现消息群发，如图2-57、图2-58、图2-59、图2-60、图2-61所示：

![2-57](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_21.png)

##### 图2-57

![2-58](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_22.png)

##### 图2-58

![2-59](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_23.png)

##### 图2-59

![2-60](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_24.png)

##### 图2-60

![2-61](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_25.png)

##### 图2-61

f）完成流程图编辑之后，保存并退出。

g）提交并发布接口。

h）编辑测试用例，录入计数变量的值，如图2-62所示：

![2-62](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_25.png)

##### 图2-62

i）执行测试用例，查看测试用例的结果，可以看到响应内容为计数变量的值，如图2-63所示：

![2-63](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_32.png)

##### 图2-63 查看结果

j）与前端做好联调后，启动前端程序，查看效果，如图2-64所示：

![2-64](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_8.png)

##### 图2-64 查看效果1

![2-65](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_30.png)

##### 图2-65 查看效果2
