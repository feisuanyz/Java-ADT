### 2. 电商平台应用

#### 2.1 商品详情文本转HTML

#### 案例背景: 在一个电商平台中，所有商品详情的数据量是相当大的，直接以文本文件方式存储在数据库容易导致存储过程缓慢、数据库存储负载过大以及不便于前端直接访问解析等问题。基于此，我们通过先将商品详情文本文件转换为HTML文件，再将HTML文件路径存储在数据库的方式，可以一定程度上缓解以上问题。

本案例将为您介绍如何使用全自动开发平台来实现商品详情文本文件转换为HTML文件的功能。通过在全自动开发平台上传一份包含商品详情的文本文件，平台将读取并解析出文本文件中的内容，之后平台会对文件的内容进行处理生成对应的HTML文件，最后上传到指定的服务器，以减轻数据库存储压力同时方便前端解析展示。案例仅用到了平台中的单函数组件、SFTP方式上传组件以及输出结果组件，通过绘制组件流程图并进行相关配置，便可以实现功能，整个过程简单快捷，节省了开发时间。

##### 2.1.1 效果展示

在全自动开发平台测试用例页面上传需要转换的文本文件，本实例以aa.txt文件为例，如图2-1、2-2所示，执行测试用例并通过测试用例执行结果是否成功以及服务器地址上是否上传了对应HTML文件、HTML文件效果是否正确来判断功能实现结果，如图2-3、2-4所示：

![2-1](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/2_1.png)

##### 图2-1 全自动开发平台参数录入界面

![2-2](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/2_2.png)

##### 图2-2 文本文件

![2-3](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/2_3.png)

##### 图2-3 测试用例执行结果

![2-4](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/2_4.png)

##### 图2-4 HTML文件展示结果

##### 2.1.2 准备工作

a）提前安装好如图2-5所示的Xshell软件，案例执行后会生成对应HTML文件上传到配置的服务器地址上，使用Xshell登录配置的服务器地址，进入接口返回的文件路径即可查看生成的HTML文件：

![2-5](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/3_1.png)

##### 图2-5 Xshell软件

b）提前准备一份文本文件：aa.txt（用于存储需转换的商品详情信息），如图2-6所示：

![2-6](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/3_2.png)

##### 图2-6 文本文件

##### 2.1.3 流程图设计概览

![2-7](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/4_1.png)

##### 图2-7 流程图设计概览

##### 逻辑描述：

【获取文件中的内容】：调用函数readFileToString(File file,String charsetName)，获取入参上传的文本文件内容，返回字符串格式。

【将文件内容转换成HTML文件】：将【获取文件中的内容】得到的字符串格式的文件内容生成HTML文件。

【SFTP方式上传】：把【将文件内容转换成HTML文件】生成的HTML文件上传到配置的服务器地址。

【输出结果】：输出【SFTP方式上传】返回的服务器文件地址。

##### 2.1.4 操作步骤1：创建SFTP资源实例

##### 说明：创建SFTP资源实例时，您需要确保项目中已添加SFTP资源加载项，具体可参见飞算云智官网文档中心( 全自动开发平台/ 操作指南 / 11资源实例 / 新增资源实例 / 新增SFTP存储资源)。

进入全自动开发平台“资源实例”功能模块，创建SFTP资源实例，用来配置HTML文件生成后存储的SFTP服务器地址，如图2-8所示：

![2-8](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_1.png)

##### 图2-8 选择资源实例

![2-9](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_2.png)

##### 图2-9 创建SFTP资源实例

##### 2.1.5 操作步骤2：创建接口-商品详情转换成HTML文件

进入全自动开发平台“接口管理”功能模块，新增接口模块并新增一个接口，填写接口的基本信息，如图2-10所示：

![2-10](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_3.png)

##### 图2-10 选择接口管理

![2-11](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_4.png)

##### 图2-11 填写接口基本信息

##### 2.1.6 操作步骤3：配置接口的入口参数

本案例需要配置接口参数fileContent（字段类型为File），用于上传需转换的文本文件，如图2-12所示：

![2-12](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_5.png)

##### 图2-12 配置接口参数

##### 2.1.7 操作步骤4：模型编辑

进入模型编辑，通过拖拽左侧组件列表中所需的组件进行模型编辑（即流程图编辑），如图2-13所示：

![2-13](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_6.png)

##### 图2-13 进入模型编辑

![2-14](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_7.png)

##### 图2-14 进行流程图编辑

##### 2.1.8 组件的具体配置（按逻辑描述展示）

a）单函数组件【获取文件中的内容】

调用系统函数readFileToString(File file,String charsetName)，用于将上传的文本文件转换字符串格式，需传入接口参数fileContent以及编码格式GB2312，如图2-15、图2-16所示：

![2-15](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_8.png)

##### 图2-15 单函数组件【获取文件中的内容】

![2-16](https://www.feisuanyz.com/fsimage/alcj-image/tohtml/5_9.png)

##### 图2-16 组件配置

##### 函数说明：
