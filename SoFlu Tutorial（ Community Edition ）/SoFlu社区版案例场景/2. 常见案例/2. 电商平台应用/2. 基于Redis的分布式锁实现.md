### 2. 电商平台应用

#### 2.2 基于Redis的分布式锁实现

为了对某一个共享变量进行多线程同步访问，同时保证该共享变量在高并发情况下的同一时间只能被一个线程执行，我们经常需要用到分布式锁。本案例将模拟多用户下单减少商品库存数量的场景为您介绍如何使用全自动开发平台实现分布式锁功能。由于Redis具有性能高、使用方便等功能特点，较为适用于分布式锁功能，故本案例将基于Redis实现。常见的应用场景有：电商平台商品秒杀、抢优惠券等。

##### 说明：案例使用全自动测试平台进行测试，全自动测试平台是我司自主开发的全自动软件工程平台中第二个实用的平台，覆盖了整个软件测试的生命周期管理，包含测试用例管理、测试计划管理、接口测试、性能测试等功能，可以一键关联和同步全自动开发平台的项目和项目中所有的接口信息。

##### 2.2.1 效果展示

本案例设置的商品初始化库存数量为10，调用初始化库存接口后，在全自动测试平台进行性能测试，设置12个并发用户同时发送下单请求（即调用分布式锁接口），此时性能测试报告显示：12个请求中，10个请求输出“调用成功”，2个请求输出“库存不足”，如图2-41所示：

![2-41](https://www.feisuanyz.com/fsimage/alcj-image/redislock/2-1.png)

##### 图2-41 性能测试报告

##### 2.2.2 流程图设计概览

a）初始化库存接口

![2-42](https://www.feisuanyz.com/fsimage/alcj-image/redislock/3-1.png)

##### 图2-42 流程图
