### 4. 以树形结构显示数据

#### 4.1 以树形结构显示数据

树形结构指的是数据元素之间存在着“一对多”的树形关系的数据结构。本节实例将以常见的试卷选择题（一个题目存在多个选项）作为示例，讲述如何利用全自动开发平台来实现以树形结构展示数据。

##### 4.1.1 效果展示

![4-1](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_2-1.png)

##### 图4-1 效果展示1

![4-2](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_2-2.png)

##### 图4-2 效果展示2

以上仅为后端程序数据展示，用户可自行设计前端Web页面，将后端程序与前端Web页面进行联调，以实现更加美观的展示方式。

##### 4.1.2 准备工作

需提前准备功能实现过程中用到的两张数据表：题目表 title（用来存储题目信息）、选项表option（用来存储选项信息），表结构设计及相关数据如图4-3、图4-4所示：

题目表 title：

```
CREATE TABLE `title` (
  `title_id` varchar(24) NOT NULL COMMENT '题目编号',
  `title_context` varchar(255) DEFAULT NULL COMMENT '题目内容',
  PRIMARY KEY (`title_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT '题目表';
```
![4-3](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_3-1.png)

##### 图4-3 题目表展示

选项表 option：

```
CREATE TABLE `option` (
  `option_id` varchar(255) NOT NULL COMMENT '选项编号',
  `option_context` varchar(255) DEFAULT NULL COMMENT '选项内容',
  `title_id` varchar(255) DEFAULT NULL COMMENT '标题编号',
  PRIMARY KEY (`option_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT '选项表';
```

![4-4](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_3-2.png)

##### 图4-4 选项表展示

##### 4.1.3 流程图设计概览

![4-5](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_4-1.png)

##### 图4-5 流程图

逻辑描述：

a）在【题目表】查询题目信息（SQL语句需确定父子级关系）。

b）在【选项表】查询选项信息（SQL语句需确定父子级关系）。

c）将前面两个单SQL组件查询出来的数据合并为一个List。

d）使用获取树形结构函数实现功能。

e）输出树型结构拼接完成的信息。

##### 4.1.4 技术要点说明

实现本实例（以树形结构显示数据）的关键在于使用全自动开发平台中的自定义函数-获取树形结构函数getBuildTree，该函数适用于确定了父子级关系的List集合数据中，即：若需使用该函数，需先准备好已确定父子级关系的List集合数据。本实例采用合并两份分别确定了父子级关系的SQL查询记录为一个List集合数据的方式来准备。

##### 函数说明：获取树形结构函数 List getBuildTree(String parentIdName,String childIdName,List valueList,String childItemName)，如图4-6所示：

![4-6](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_5-1.png)

##### 图4-6 参数描述

##### 4.1.5 操作步骤

a）新增树形结构接口

a1）进入全自动开发平台“接口管理”功能模块，新增接口模块并新增一个接口，填写接口的基本信息，如图4-7所示：

![4-7](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-2.png)

##### 图4-7 新增接口

a2）因本实例不需要配置入口参数，直接单击“提交”，进入下一步模型编辑即可，如图4-8所示：

![4-8](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-3.png)

##### 图4-8 点击提交

b）模型编辑

通过拖拽左侧组件列表中所需的组件进行模型编辑（即流程图编辑），如图4-9、图4-10所示：

![4-9](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-4.png)

##### 图4-9 进入模型编辑

![4-10](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-5.png)

##### 图4-10 进行模型编辑

c）组件的具体配置（按逻辑描述展示）

c1）在【题目表】查询题目信息（SQL语句需确定父子级关系），如图4-11、图4-12、图4-13所示：

##### 说明：使用单SQL组件进行查询，具体SQL内容如下，其中title_id（题目编号）作为题目记录中的子级id，以别名childId作为标识。

![4-11](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-6.png)

##### 图4-11 使用单SQL组件进行查询

![4-12](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-7.png)

##### 图4-12 填写数据

![4-13](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-8.png)

##### 图4-13 SQL内容

##### 注意：若对于如何新增SQL语句不清晰，可参见[《SoFlu社区版快速入门教程第4.6节：如何新增SQL信息》](https://gitee.com/feisuanyz/SoFlu-adp/blob/master/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E6%95%99%E7%A8%8B/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B.md#46-%E5%A6%82%E4%BD%95%E6%96%B0%E5%A2%9Esql%E4%BF%A1%E6%81%AF)

c2）在【选项表】查询选项信息（SQL语句需确定父子级关系），如图4-14、图4-15、图4-16所示：

##### 说明：同样使用单SQL组件进行查询，具体SQL内容如下，其中option_id（选项编号）、title_id（题目编号）分别作为子级id和父级id，以别名childId和parentId进行标识。

![4-14](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-9.png)

##### 图4-14 使用单SQL组件进行查询

![4-15](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-10.png)

##### 图4-15 填写数据

![4-16](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-11.png)

##### 图4-16 SQL内容

c3）将前面两个单SQL组件查询出来的数据合并为一个List，如图4-17、图4-18所示：

##### 说明：使用单函数组件调用函数listAddList(List fromList,List toList)将来源List添加到目标list，其中目标List为第1步查询【题目表】的执行结果、来源List为第2步查询【选项表】的执行结果。

![4-17](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-12.png)

##### 图4-17 合并两个List数据

![4-18](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-13.png)

##### 图4-18 填写数据

c4）使用获取树形结构函数实现功能，如图4-19、图4-20所示：

##### 说明：使用单函数组件调用获取树形函数getBuildTree(String parentIdName,String childIdName,List valueList,String childItemName)，其中parentIdName（父级字段名称）传入parentId，childIdName（关联子字段名称）传入childId，valueList（数据值）传入目标List即第1步查询返回的List集合，childItemName子项名称传入itemList。

![4-19](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-14.png)

##### 图4-19 获取树型结构

![4-20](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-15.png)

##### 图4-20 填写数据

c5）输出树型结构拼接完成的信息，如图4-21、图4-22、图4-23所示：

##### 说明：使用输出结果组件将第4步已获取树形结构的List集合数据输出。

![4-21](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-16.png)

##### 图4-21 使用输出结果组件

![4-22](https://www.feisuanyz.com/fsimage/alcj-image/treestructure/tree_6-17.png)
