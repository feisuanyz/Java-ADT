### 5. 生成操作日志

#### 5.1 生成操作日志

操作日志在每个系统中都是必不可少的，用户在系统中进行每一项操作时，都会调用生成操作日志的程序实时生成对应的操作日志。根据这样的功能特性，可以很好地借助全自动开发平台中的子流程来实现，子流程中专门放置生成操作日志的程序，这样在进行每一项操作时，都会调用该子流程达到生成对应操作日志的效果。下文将为您介绍利用全自动开发平台实现生成操作日志功能的具体操作过程。

##### 5.1.1 效果展示

生成操作日志功能效果：通过执行测试接口，调用生成操作日志子流程，即可实现在数据库中保存用户操作记录，如图5-1所示，本实例仅针对后端程序开发，若与前端页面进行联调，即可实现如图5-2所示的效果。

![5-1](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/2_1.png)

##### 图5-1 用户操作日志表记录

![5-2](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/2_2.png)

##### 图5-2 前端页面效果

##### 5.1.2 准备工作

在数据库中准备一张数据表：用户操作日志表sy_log（用于存储用户操作的日志记录），表结构设计及相关数据如下图所示。

用户操作日志表sy_log：

```
CREATE TABLE `sy_log` (
  `auto_id` varchar(24) NOT NULL COMMENT '日志编号',
  `content` varchar(100) DEFAULT NULL COMMENT '内容',
  `log_type` varchar(50) DEFAULT NULL COMMENT '日志类型(1增加2删除3修改4查询5导出6清除历史数据7备份数据库8登录系统9退出系统)',
  `log_time` datetime DEFAULT NULL COMMENT '操作时间',
  `user_id` varchar(24) DEFAULT NULL COMMENT '用户账户',
  `from_ip` varchar(15) DEFAULT NULL COMMENT '来源ip',
  PRIMARY KEY (`auto_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户操作日志';
```
![5-3](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/3_1.png)

##### 图5-3 用户操作日志表展示

说明：a）用户操作日志表中的数据在执行测试接口后自动生成；b）关于日志类型的具体数值说明，您可以根据实际需求自行定义。

##### 5.1.3 流程图设计概览

因本实例的实现需要用到子流程，所以以下将为您展示两张流程图设计，即生成操作日志子流程的流程设计和测试接口的流程设计。

a）生成操作日志子流程

![5-4](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/4_1.png)

##### 图5-4 子流程图

逻辑描述：

a1）为用户操作日志赋值，作为新增操作日志的入参；

a2）在用户操作日志表中新增日志记录。

b）测试接口

![5-5](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/4_2.png)

##### 图5-5 测试流程

逻辑描述：

b1）获取执行操作的IP地址；

b2）调用生成操作日志子流程，并为入参赋值；

b3）查询【用户操作日志表】中的所有操作日志；

b4）输出操作日志列表。

##### 5.1.4 操作步骤

a）创建实体模型

进入全自动开发平台“实体模型”功能模块，新增一个实体模型SyLog，用于为用户操作日志赋值，如图5-6、图5-7所示：

##### 说明：实体模型设计与用户操作日志表设计一致。

![5-6](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/5_1.png)

##### 图5-6 实体模型模块

![5-7](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/5_2.png)

##### 图5-7 新增实体模型

b）创建生成操作日志子流程

b1）填写子流程基本信息

进入全自动开发平台“子流程管理”功能模块，新增一个子流程，填写子流程的基本信息，单击“下一步”。

![5-8](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/5_3.png)

##### 图5-8 子流程管理模块

![5-9](https://www.feisuanyz.com/fsimage/alcj-image/systemlog/5_4.png)

##### 图5-9 填写子流程基本信息
