### 4. 身份证识别

#### 4.1 身份证识别

本实例是结合腾讯云实现身份证识别的功能，实例仅用到了平台中的单函数组件和输出组件，可适用于实名认证APP、信用卡申请、海关物流等多种不同的业务场景。

##### 4.1.1 效果展示

进入全自动开发平台“身份证识别”功能接口测试用例页面，在接口入参处上传身份证图片文件，并输入身份证文件的类型（即上传的身份证文件为正面还是反面），启动可视化日志后执行该接口，即可返回身份证图片上的个人信息，如图4-2所示：

![4-1](https://www.feisuanyz.com/fsimage/alcj-image/idcard/2_1.png)

##### 图4-1 测试用例编辑页面

![4-2](https://www.feisuanyz.com/fsimage/alcj-image/idcard/2_2.png)

##### 图4-2 身份证信息展示

##### 4.1.2 准备工作

a）提前准备一个开通了文字识别服务的腾讯云账号。

##### 说明：a1）关于如何注册腾讯云账号可参见[文档1（文档中心 > 账号相关 > 注册腾讯云）](https://cloud.tencent.com/document/product/378/17985)；a2）关于如何开通文字识别服务可参见[文档2（文档中心 > 文字识别 > 快速入门 > 一分钟接入服务端 API）
](https://cloud.tencent.com/document/product/866/34681)

b）需进入腾讯云控制台获取相关参数，放入全自动开发平台配置组管理中，如图4-3所示：

![4-3](https://www.feisuanyz.com/fsimage/alcj-image/idcard/3_1.png)

##### 图4-3 配置组展示

##### 说明：此处的参数字段分别为secretId（腾讯云密钥secretId）、secretKey（腾讯云密钥secretId），其参数值均可以在腾讯云控制台获取。因本案例需与腾讯云结合使用，具体的参数值需要用户自行创建密钥，如图4-4所示：

![4-4](https://www.feisuanyz.com/fsimage/alcj-image/idcard/3_2.png)

##### 图4-4 腾讯云控制台

##### 注意：若对于如何新增配置组不清晰，可参见文档[《SoFlu社区版基础操作指南第13.1节：新增配置组》](https://gitee.com/feisuanyz/SoFlu-adp/blob/master/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E6%95%99%E7%A8%8B/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E9%85%8D%E7%BD%AE%E7%BB%84%E7%AE%A1%E7%90%86/1.%20%E6%96%B0%E5%A2%9E%E9%85%8D%E7%BD%AE%E7%BB%84.md)

##### 4.1.3 流程图设计概览

![4-5](https://www.feisuanyz.com/fsimage/alcj-image/idcard/4_1.png)

##### 图4-5 接口流程图

逻辑描述：

a）将上传的身份证图片文件转换为base64字符串；

b）构建身份证识别函数所需的参数；

c）将构建参数传入身份证识别函数；

d）根据身份证识别函数返回值，构建身份证显示信息。

e）使用输出结果组件输出上一步构建的身份证显示信息。

##### 4.1.4 技术要点说明

本案例主要通过身份证识别函数idCardOcr(Map params) 实现，函数说明如图4-6所示：

![4-6](https://www.feisuanyz.com/fsimage/alcj-image/idcard/5_1.png)

##### 图4-6 函数说明

##### 4.1.5 操作步骤

a）新增身份证识别接口

进入全自动开发平台“接口管理”功能模块，新增接口模块并新增一个接口，填写接口的基本信息，如图4-7所示：

![4-7](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_1.png)

##### 图4-7 新增接口

b）配置接口的入口参数

此处需配置String类型参数idCardType（身份证类型）用于区分身份证正反面，File类型参数idCardFile（身份证文件）用于上传身份证文件，如图4-8所示：

![4-8](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_2.png)

##### 图4-8 配置接口入参

c）模型编辑

单击“进入模型编辑”，您可以在窗体视图页面，通过拖拽左侧组件列表中的组件进行接口流程图的设计，如图4-9、图4-10所示：

![4-9](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_3.png)

##### 图4-9 进入模型编辑器

![4-10](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_4.png)

##### 图4-10 模型编辑器

d）组件的具体配置（按逻辑描述展示）

d1）将上传的身份证图片文件转换为base64字符串。

使用单函数组件调用函数getFileToBase64(File file)，需传入接口参数idCardFile（身份证文件）。

![4-11](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_5.png)

##### 图4-11 单函数组件【文件转base64】

![4-12](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_6.png)

##### 图4-12 组件配置

d2）构建身份证识别函数所需的参数。

具体可参见函数说明，其中imageBase64（图片的Base64 值）参数值引用上一步单函数组件【文件转base64字符串】的执行结果，cardSid（身份证正反面）引用接口参数idCardType（身份证类型），secretId（腾讯云密钥secretId）以及secretKey（腾讯云密钥secretId）引用配置组参数值即可。

![4-13](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_7.png)

##### 图4-13 单函数组件【构建身份证所需参数】

![4-14](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_8.png)

##### 图4-14 调用构建Map函数

![4-15](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_9.png)

##### 图4-15 赋值参数1（记录1-记录4）

![4-16](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_10.png)

##### 图4-16 赋值参数2（记录5-记录8）

d3）将构建参数传入身份证识别函数，直接引用单函数组件【构建身份证所需要的参数】的执行结果即可。

![4-17](https://www.feisuanyz.com/fsimage/alcj-image/idcard/6_11.png)

##### 图4-17 单函数组件【身份证识别】
