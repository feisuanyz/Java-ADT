### 4. 文件组件

#### 4.8 数据导出Excel组件的使用

##### 4.8.1 数据导出Excel组件

数据导出Excel组件是导出Excel组件的升级版，用于导出自行创建的Excel文件。导出的Excel文件中可创建多个表单，并自行设置表单名、标题集合和记录集合。本节将通过具体实例来介绍数据导出Excel组件的使用。

##### 4.8.2 案例介绍

本节案例需实现导出一张具有两张表单的Excel表，第一张表单的名称为“学生总数”，标题字段为“总数”，第二张表单的名称为“学生信息”，标题字段为“学号”和“姓名”，如图8-1、8-2所示：

![8-1](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/2.png)

##### 图8-1 学生总数表单

![8-2](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/3.png)

##### 图8-2 学生信息表单

##### 4.8.3 流程图展示

![8-3](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/1.png)

##### 图8-3 流程图展示

逻辑描述：

a）通过单SQL组件查询学生总数，获取第一张表单里的记录，数据类型为List< Map>。

b）通过单SQL组件查询学生信息，获取第二张表单里的记录，数据类型为List< Map>。

c）为两张表单里的标题字段赋值。

d）将获取的学生总数记录的数据类型由List< Map>转换为List< String>。

e）将获取的学生信息记录的数据类型由List< Map>转换为List< String>。

f）利用数据导出Excel组件将Excel文件导出。

##### 4.8.3 前提条件

a）数据库中准备好学生表的数据。

b）利用接口生成器生成查询学生表相关的SQL语句，详情可参见[《SoFlu社区版快速入门教程第4.10节：如何自动生成SQL信息》](https://gitee.com/feisuanyz/SoFlu-adp/blob/master/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E6%95%99%E7%A8%8B/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/SoFlu%E7%A4%BE%E5%8C%BA%E7%89%88%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B.md#410-%E5%A6%82%E4%BD%95%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90sql%E4%BF%A1%E6%81%AF)。

##### 4.8.4 操作步骤

a）进入实体模型功能模块，新增一个实体模型。该实体模型作为需导出的两张表单的标题字段集合，用于之后流程图编辑中对标题字段进行赋值，具体配置如图8-4所示，其中oneTitle表示第一张表单的标题字段、twoTitle表示第二张表单的标题字段。

![8-4](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/4.png)

##### 图8-4 实体模型配置

b）进入接口管理功能模块，新增一个接口，填写接口的基本信息，HTTP方法选择“GET”，如图8-5所示：

![8-5](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/5.png)

##### 图8-5 填写接口基本信息

c）该接口不需配置入口参数，直接进入模型编辑（即接口的流程图设计），注意关键的数据导出Excel组件，如图8-6、图8-7所示：

![8-6](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/6.png)

##### 图8-6 进入模型编辑

![8-7](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/7.png)

##### 图8-7 数据导出Excel组件

d）各组件的详细配置展示如下。

d1）单SQL组件【查询学生总数】：用于查询学生表中学生记录的总数，故组件配置中SQL名称选择count_Xuesheng，其他信息可选填，如图8-8、图8-9所示：

![8-8](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/8.png)

##### 图8-8 查询学生总数组件

![8-9](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/9.png)

##### 图8-9 填写数据

d2）单SQL组件【查询学生信息】：用于查询学生表中的学生信息数据，故组件配置中SQL名称选择list_Xuesheng，其他信息可选填，如图8-10、图8-11所示：

![8-10](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/11.png)

##### 图8-10 查询学生信息组件

![8-11](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/12.png)

##### 图8-11 填写数据

![8-12](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/10.png)

##### 图8-12 SQL参数详情

d3）赋值组件【标题赋值】：用于为需导出Excel文件中两张表单的标题字段进行赋值，其中实体模型选择TitleList，再根据表单的实际情况进行赋值，如图8-12、图8-13所示：

![8-12](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/14.png)

##### 图8-12 标题赋值组件

![8-13](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/15.png)

##### 图8-13 表格选择

![8-14](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/16.png)

##### 图8-14 填写模型数据

d4）单函数【学生count类型转换】：用于将单SQL组件【查询学生总数】 查询出的List< Map>类型数据转换为List< String>类型数据，以便在数据导出Excel组件【导出Excel文件学生信息】 中使用。用到的函数是mapToList(List list,String[] keys)，传入的参数值如图8-15、图8-16所示：

![8-15](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/17.png)

##### 图8-15 学生count类型转换组件

![8-16](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/18.png)

##### 图8-16 填写数据

d5）单函数【学生信息类型转换】：用于将单SQL组件【查询学生信息】 查询出的List< Map>类型数据转换为List< String>类型数据，以便在数据导出Excel组件【导出Excel文件学生信息】 中使用。用到的函数是mapToList(List list,String[] keys)，传入的参数值如图8-17、图8-18所示：

![8-17](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/19.png)

##### 图8-17 学生信息类型转换组件

![8-18](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/20.png)

##### 图8-18 填写数据

d6）数据导出Excel组件【导出Excel文件学生信息】：用于引用以上组件的执行结果，将Excel文件导出，Excel文件名称及Excel文件中各表单的表单页、表单名根据实际情况进行填写，如图8-19、图8-20所示：

![8-19](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/21.png)

##### 图8-19 导出Excel文件学生信息组件

![8-20](https://www.feisuanyz.com/fsimage/zc-image/zjsy/dataexportexcel/22.png)

##### 图8-20 填写数据

e）接口的流程图设计完成之后，保存并退出。

f）提交并发布接口。
