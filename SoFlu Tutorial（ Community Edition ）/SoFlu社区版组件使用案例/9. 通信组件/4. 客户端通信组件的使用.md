### 9. 通信组件

#### 9.4 客户端通信组件的使用

##### 9.4.1 客户端通信组件

客户端通信组件主要用于支持WebSocket协议，实现服务端主动向客户端推送消息。本节将通过具体案例来介绍如何利用客户端通信组件实现消息的主动推送。

##### 说明：WebSocket协议是一种在单个TCP连接上进行全双工通信的协议，它允许服务端主动向客户端推送数据，客户端和服务端只需要完成一次握手，两者之间就可以创建持久性的连接并双向传输数据，这使得客户端和服务端之间的数据交换变得更加简单。

##### 9.4.2 结果展示

案例主要是通过服务端主动向客户端推送计数变量值，实现一个倒计时的效果，如下图所示：

![4-1](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_8.png)

##### 图4-1 倒计时效果

##### 9.4.3 流程图展示

案例主要是通过服务端主动向客户端推送计数变量值，实现一个倒计时的效果，如下图所示：

![4-2](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_7.png)

##### 图4-2 流程图展示

##### 9.4.4 操作步骤

a）为项目添加客户端通信组件加载项，如图4-3所示：

![4-3](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_1.png)

##### 图4-3 添加客户端通信组件加载项

b）新增一个接口，接口协议选择WebSocket，如图4-4所示：

![4-4](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_2.png)

##### 图4-4 新增接口

c）配置接口的入口参数，本实例需要添加计数变量a，如图4-5所示：

![4-5](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_9.png)

##### 图4-5 添加计数变量

d）通过拖、拽、拉的方式进行模型编辑（即流程图编辑），需注意关键的组件客户端通信组件，如图4-6所示：

![4-6](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_10.png)

##### 图4-6 进行模型编辑

e）接下来将对组件的具体配置进行展示。

e1）计数器组件【录入计数变量、实现逐次递减】：用于引用计数变量，并实现计数变量的逐次递减。计数器组件的循环流程变量选择入口参数计数变量a，操作符选择递减，如图4-7、图4-8所示：

![4-8](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_11.png)

##### 图4-8 计数器组件

![4-9](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_13.png)

##### 图4-9 选择入口参数计数变量a

e2）互斥条件组件【判断计数变量是否大于0】：用于判断计数变量的值是否大于0，若大于0，则通过客户端通信组件主动推送计数变量的值，若小于等于0，则结束程序，两条顺序流的流转条件的设置如图所示：

![4-10](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_15.png)

##### 图4-10 互斥条件组件

![4-11](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_16.png)

##### 图4-11 顺序流1

![4-12](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_17.png)

##### 图4-12 参数选择

![4-13](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_18.png)

##### 图4-13 流转条件1

![4-14](https://www.feisuanyz.com/fsimage/zc-image/jkgl/websock_26.png)

##### 图4-14 顺序流1
