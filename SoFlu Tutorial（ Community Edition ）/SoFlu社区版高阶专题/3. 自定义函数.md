### 3. 自定义函数

#### 3.1 自定义函数

函数，也就是类似于工具类，用户可以将编写好的函数打包为一个Jar包，然后上传到平台即可。

#### 3.1.1 if 标签

自定义函数需要下载如下Demo工程包和开发辅助工具，具体如下：

a）函数Demo工程包下载地址：demo-function.zip

b）下载开发辅助工具：在全自动开发平台中，单击右上角下载开发辅助工具，如图1-1所示：

![1-1](https://www.feisuanyz.com/fsimage/gj-image/gj_0000_img.png)

##### 图1-1 下载开发辅助工具

#### 3.1.2 操作步骤

a）对自定义函数注释注解。

##### 注意：由于函数是一个工具类，所以函数里面的方法需要全部定义为静态公有的（Public Static）。

在定义函数的时候必须要为所定义的每一个函数编写注释，这是通过专门的注释注解来完成的。之所以要这样，是因为源码中虽然有Java Doc注释，但是编译后的Class文件中是获取不到这些注释信息的，因此为了从Class文件中获取注释且避免采用额外的DB来保存这些注释信息，故而采用注解的方式来保存注释信息是最行之有效的方式，且简单不需要做其他额外的事情。

注释注解定义有2个，两者需要结合起来使用，它们被定义在` flow-core-cmptJar `包中，因此定义函数时导入此Jar包即可。

a1）MethodDesc

`com.feisuanyz.flow.core.cmpt.annotation.function.MethodDesc`

```
/* 
 * All rights Reserved, Designed By www.feisuanyz.com
 * @title     MethodDesc.java   
 * @package   com.feisuanyz.flow.core.cmpt.annotation.function   
 * @version   V1.0 
 * @copyright 2020 www.feisuanyz.com Inc. All rights reserved.
*/
package com.feisuanyz.flow.core.cmpt.annotation.function;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**   
 * <p>
 *   函数(方法)信息描述注解
 * <p>
 * 	用来对类中的方法(函数)进行描述。
 * 
 * @author 飞算云智
 * @date yyyy-mm-dd HH:mm
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Inherited
@Documented
public @interface MethodDesc {
    
    /** 
     * <p>
     * 	 方法描述
     * </p>
     * @return String 
     */
    String desc();
    
    /** 
     * <p>
     * 	 参数描述信息列表
     * </p>
     * @return ParamDesc[] 
     */
    ParamDesc[] params();

}
```

a2）ParamDesc

```
com.feisuanyz.flow.core.cmpt.annotation.function.ParamDesc
```

```
/* 
 * All rights Reserved, Designed By www.feisuanyz.com
 * @title     ParamDesc.java   
 * @package   com.feisuanyz.flow.core.cmpt.annotation.function   
 * @version   V1.0 
 * @copyright 2020 www.feisuanyz.com Inc. All rights reserved. 
 */
package com.feisuanyz.flow.core.cmpt.annotation.function;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**   
 * <p>
 *   函数参数描述注解
 * <p>
 * 	用来对函数中的参数进行描述。
 * 
* @author 飞算云智
 * @date yyyy-mm-dd HH:mm
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Inherited
@Documented
public @interface ParamDesc {

    /** 
     * <p>
     * 	 参数名称
     * </p>
     * @return String 
     */
    String name();
    
    /** 
     * <p>
     * 	 参数描述
     * </p>
     * @return String 
     */
    String desc();
}
```

使用示例：

```
/* 
 * All rights Reserved, Designed By www.feisuanyz.com
 * @title     Calculator.java   
 * @package   com.feisuanyz.ops.function  
 * @version   V1.0 
 * @copyright 2020 
 */
package com.feisuanyz.ops.function;

import com.feisuanyz.flow.core.cmpt.annotation.function.MethodDesc;
import com.feisuanyz.flow.core.cmpt.annotation.function.ParamDesc;

/**   
 * <p>
 *   计算器
 * </p>
* @author 飞算云智
 * @date yyyy-mm-dd HH:mm
 */
public final class Calculator {
    
    private Calculator() {
    }
    
    /** 
     * <p>
     * 	 两个数相加
     * </p>
     * @param a
     * @param b
     * @return int 
     */
    @MethodDesc(desc = "两个数相加", params = {
        @ParamDesc(name = "a", desc = "参数a"),
        @ParamDesc(name = "b", desc = "参数b")
    })
    public static int add(int a, int b) {
        return a + b;
    }
    
    /** 
     * <p>
     * 	 两个数相减
     * </p>
     * @param a
     * @param b
     * @return int 
     */
    @MethodDesc(desc = "两个数相减", params = {
        @ParamDesc(name = "a", desc = "参数a"),
        @ParamDesc(name = "b", desc = "参数b")
    })
    public static int subtract(int a, int b) {
        return a - b;
    }
```

b）编写XML定义文件

函数的定义需要按照以下xml格式进行描述，然后存放到项目中的` resources `目录下名为` functions.xml `的文件中，并一起打成Jar包上传到平台即可。

##### 注意：目前如果某个函数类不用了，XML定义文件中配置的类信息以及函数类Java源文件不能删除，还是要继续保留着，不然上传Jar包时检查不通过会报错——会检查DB中此Jar包上一个版本包含的类数量和正在上传版本中所配置的类数量是否匹配（是否匹配是通过name属性来判断的，name属性值相同则认为DB中的类还存在于正在上传Jar包的配置中，否则认为不存在）。所以最好不要修改name属性的值。

XML文件示例如下：
