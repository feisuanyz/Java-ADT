### 4. 测试场景

#### 4.4 测试场景配置

##### 4.4.1 集合变量器的使用

集合变量器作为SQL管理、变量集、Excel管理的媒介，用户可以通过集合变量器获取这三种集合的数据，包含集合的所有结果、集合的长度以及集合的某一个值。本节将结合集合变量器、循环控制器获取SQL管理中的数据，来为您展示如何使用集合变量器。

##### 4.4.1.1 前提条件

集合变量器的使用在测试场景中进行，您需要提前创建好测试场景，关于如何创建测试场景具体可参见[《SoFlu全自动测试平台教程第4.3.3节：新建测试场景》](https://gitee.com/feisuanyz/SoFlu-adp/blob/master/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF/3.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%AE%A1%E7%90%86/2.%20%E6%96%B0%E5%BB%BA%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF.md)。

##### 4.4.1.2 操作步骤

a）进入全自动测试平台，单击页面上方“测试场景 > SQL管理”，进入SQL管理页面，新增一条SQL数据集，如图1-1所示：

##### 说明：本节用到的SQL数据集如图1-2所示，用于查询产品信息。

##### 若对于新增SQL数据集不清晰，具体可参见[《SoFlu全自动测试平台教程第4.2.1.2.2.2节：新增数据集》](https://gitee.com/feisuanyz/SoFlu-adp/blob/master/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF/2.%20%E6%95%B0%E6%8D%AE%E9%9B%86%E7%AE%A1%E7%90%86/1.%20SQL%E7%AE%A1%E7%90%86/2.%20%E6%95%B0%E6%8D%AE%E9%9B%86/2.%20%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE%E9%9B%86.md)。

![1-1](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_1.png)

##### 图1-1 SQL管理页面

![1-2](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_2.png)

##### 图1-2 SQL数据集示例

b）进入测试场景管理页面，选中创建好的根测试场景，单击三个点按钮，选择“配置器 > 集合变量器”，如图1-3所示：

![1-3](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_3.png)

##### 图1-3 测试场景管理页面

c）进入新增集合变量器页面，填写集合变量器的名称，单击“确定”即可，如图1-4所示：

![1-4](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_4.png)

##### 图1-4 测试场景管理页面

d）配置集合变量器，如图1-5所示：

![1-5](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_5.png)

##### 图1-5 配置集合变量器

e）变量类型选择“SQL管理”，如图1-6所示：

![1-6](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_6.png)

##### 图1-6 选择变量类型

f）系统弹出SQL选择页面，选择需获取数据的SQL数据集，本节选择创建好的“查询产品信息”数据集，单击“确定”即可，如图1-7所示：

![1-7](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_7.png)

##### 图1-7 选择变量类型

g）填写集合变量器的变量名，用于后续引用集合变量器所指代的SQL数据集，具体的引用规则如图1-8所示：

##### 说明：一个集合变量器仅可以引用一个SQL数据集或一个变量集或一个Excel文件，不能引用多个数据集。

![1-8](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_8.png)

##### 图1-8 设置集合变量器变量名

h）再次选择创建好的根测试场景，单击三个点按钮，选择“逻辑控制器 > 流程控制器”，如图1-9所示：

![1-9](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_9.png)

##### 图1-9 选择流程控制器

i）配置流程控制器，流程类型选择“循环控制器”，如图1-10所示：

![1-10](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_10.png)

##### 图1-10 设置流程类型

j）设置循环控制器的循环次数，循环控制器的引用规则如图1-11所示：

##### 说明：此处根据集合变量器的引用规则取SQL类型的集合长度作为循环次数，即：${变量名_字段列名_#}，其中集合变量器的变量名为sql01，需取的字段列名为product_id，故填写为${sql01_product_id_#}。

![1-11](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_11.png)

##### 图1-11 设置循环次数

k）在流程控制器（即循环控制器）下关联一个接口，用于遍历循环，如图1-12所示：

![1-12](https://www.feisuanyz.com/fstest/cscj/cscjpeizhi/collection_12.png)

##### 图1-12 关联接口
