### 4. 测试场景组件介绍

#### 4.7 配置器

##### 4.7.5 集合变量器

集合变量器作为SQL管理、变量集、Excel管理的媒介，用户可以通过集合变量器获取这三种集合的数据，包含集合的所有结果、集合的长度以及集合的某一个值。

本节将结合集合变量器、循环控制器获取SQL管理中的数据，来为您展示如何使用集合变量器。

##### 4.7.5.1 前提条件

集合变量器的使用在测试场景中进行，您需要提前创建好测试场景，关于如何创建测试场景具体可参见《SoFlu全自动测试平台教程操作指南第2.4.1.1节：新增测试场景》。

##### 4.7.5.2 操作步骤

a）进入全自动测试平台，单击页面上方接口测试 > SQL管理，进入SQL管理页面，新增一条SQL数据集。

![image](https://user-images.githubusercontent.com/79617492/194693665-57e78e7f-0649-4127-98e8-12be43ad7b04.png)

##### 图5-1 新增一条SQL数据集

```
说明：

本节用到的SQL数据集如图所示，用于查询名单信息。

若对于新增SQL数据集不清晰，具体可参见《SoFlu全自动测试平台教程操作指南第2.4.3.1.5节：新增SQL数据集》。
```

![image](https://user-images.githubusercontent.com/79617492/194693677-33771736-143a-4762-a13c-141e16cffa61.png)

##### 图5-2 编辑SQL数据集

b）进入测试场景管理页面，选中根场景组，然后单击＋号按钮 > 配置器。

![image](https://user-images.githubusercontent.com/79617492/194693689-273a8587-4d6c-4f9d-9f26-bf2859326b28.png)

##### 图5-3 单击＋号按钮 > 配置器

c）选择”集合变量器”。

![image](https://user-images.githubusercontent.com/79617492/194693695-552770ab-5f7f-4935-b555-c6d0a842eb15.png)

##### 图5-4 选择”集合变量器”

d）变量类型选择”SQL管理”。

![image](https://user-images.githubusercontent.com/79617492/194693698-52d31e06-b424-4a65-a065-51a6b566f6c4.png)

##### 图5-5 变量类型选择”SQL管理”。

e）系统弹出SQL选择页面，选择需获取数据的SQL数据集，本节选择创建好的“查询名单信息”数据集，然后单击确定。

![image](https://user-images.githubusercontent.com/79617492/194693708-7a5521d6-107e-44b7-9a1a-ad5041c77547.png)

##### 图5-6 选择数据集

f）填写集合变量器的变量名，用于后续引用集合变量器所指代的SQL数据集。

![image](https://user-images.githubusercontent.com/79617492/194693725-06e151d7-f391-44af-b6cf-808364b64318.png)

##### 图5-7 填写集合变量器的变量名

```
说明：

f1）一个集合变量器仅可以引用一个SQL数据集或一个变量集或一个Excel文件，不能引用多个数据集。

f2）引用集合变量名规则：

f2-1）取SQL集合所有结果：${变量名}

f2-2）取SQL类型的集合长度：${变量名_字段列名_#}

f2-3）取SQL查询结果中第几行的值：${变量名_字段列名_索引下标值}，索引下标值从1开始。
```

g）再次选中根场景组，然后单击＋号按钮 > 逻辑控制器。

![image](https://user-images.githubusercontent.com/79617492/194693729-7722f563-5e0f-4f10-8d92-c625a0b50205.png)

##### 图5-8 单击＋号按钮 > 逻辑控制器

h）选择“流程控制器”，流程类型选择“循环控制器”，然后输入循环次数。

![image](https://user-images.githubusercontent.com/79617492/194693733-c82c2719-7f75-45f8-b875-1d703252c7d7.png)

##### 图5-9 选择“循环控制器”并输入次数

```
说明：

此处根据集合变量器的引用规则取SQL类型的集合长度作为循环次数，即：${变量名_字段列名_#}，其中集合变量器的变量名为name，需取的字段列名为id_no，故填写为${name_id_no_#}。
```

i）选中逻辑控制器，然后单击＋号按钮 > 接口。

![image](https://user-images.githubusercontent.com/79617492/194693747-314556c1-d662-43e2-a03c-f28039ab5c15.png)

##### 图5-10 单击＋号按钮 > 接口

j）进入选择接口页面，勾选好接口，然后单击确定。

![image](https://user-images.githubusercontent.com/79617492/194693862-7148add6-f0c2-4b8c-8b8d-f91b822061ac.png)

##### 图5-11 勾选好接口

k）单击保存，然后再单击执行，进行执行测试场景。

![image](https://user-images.githubusercontent.com/79617492/194693880-8cac00a3-a213-4fb0-a822-486f89d00e5f.png)

##### 图5-12 执行测试场景

l）系统弹出“执行报告“页面，显示所有的循环结果。

![image](https://user-images.githubusercontent.com/79617492/194693894-255959e8-b5de-427f-8149-c3be57a63bbc.png)

##### 图5-13 显示所有的循环结果
