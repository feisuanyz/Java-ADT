### 4. 测试场景组件介绍

#### 4.7 配置器

##### 4.7.5 集合变量器

集合变量器作为SQL管理、变量集、Excel管理的媒介，用户可以通过集合变量器获取这三种集合的数据，包含集合的所有结果、集合的长度以及集合的某一个值。

本节将结合集合变量器、循环控制器获取SQL管理中的数据，来为您展示如何使用集合变量器。

##### 4.7.5.1 前提条件

集合变量器的使用在测试场景中进行，您需要提前创建好测试场景，关于如何创建测试场景具体可参见《SoFlu全自动测试平台教程操作指南第2.4.1.1节：新增测试场景》。

##### 4.7.5.2 操作步骤

a）进入全自动测试平台，单击页面上方接口测试 > SQL管理，进入SQL管理页面，新增一条SQL数据集。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-1.png)

##### 图5-1 新增一条SQL数据集

```
说明：

本节用到的SQL数据集如图所示，用于查询名单信息。

若对于新增SQL数据集不清晰，具体可参见《SoFlu全自动测试平台教程操作指南第2.4.3.1.5节：新增SQL数据集》。
```

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/image.png)

##### 图5-2 编辑SQL数据集

b）进入测试场景管理页面，选中根场景组，然后单击＋号按钮 > 配置器。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-3.png)

##### 图5-3 单击＋号按钮 > 配置器

c）选择”集合变量器”。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-4.png)

##### 图5-4 选择”集合变量器”

d）变量类型选择”SQL管理”。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-5.png)

##### 图5-5 变量类型选择”SQL管理”。

e）系统弹出SQL选择页面，选择需获取数据的SQL数据集，本节选择创建好的“查询名单信息”数据集，然后单击确定。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-6.png)

##### 图5-6 选择数据集

f）填写集合变量器的变量名，用于后续引用集合变量器所指代的SQL数据集。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-7.png)

##### 图5-7 填写集合变量器的变量名

```
说明：

f1）一个集合变量器仅可以引用一个SQL数据集或一个变量集或一个Excel文件，不能引用多个数据集。

f2）引用集合变量名规则：

f2-1）取SQL集合所有结果：${变量名}

f2-2）取SQL类型的集合长度：${变量名_字段列名_#}

f2-3）取SQL查询结果中第几行的值：${变量名_字段列名_索引下标值}，索引下标值从1开始。
```

g）再次选中根场景组，然后单击＋号按钮 > 逻辑控制器。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-8.png)

##### 图5-8 单击＋号按钮 > 逻辑控制器

h）选择“流程控制器”，流程类型选择“循环控制器”，然后输入循环次数。

![输入图片说明](../../../images/SoFlu%E5%85%A8%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E6%95%99%E7%A8%8B/4.%20%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/7.%20%E9%85%8D%E7%BD%AE%E5%99%A8/5-9.png)

##### 图5-9 选择“循环控制器”并输入次数

##### 说明：此处根据集合变量器的引用规则取SQL类型的集合长度作为循环次数，即：${变量名_字段列名_#}，其中集合变量器的变量名为name，需取的字段列名为id_no，故填写为${name_id_no_#}。
