### 4. 控件使用指南

#### 4.4 布局控件

#### 4.4.2 列表上滑加载

列表上滑加载组件使用瀑布流滚动加载，用于展示长列表，当列表滚动到底部时，会触发事件并加载更多列表项。

#### 4.4.2.1 基本属性

a）组件描述：可输入对控件的描述，字符限制在200字符以内。

![image](https://user-images.githubusercontent.com/79617492/219599333-fb2ef4c3-99cf-4199-9229-04560154e599.png)

##### 图2-1 组件描述

b）是否加载完成：开启该状态后表示列表已经加载完成，不再触发加载事件，可绑定变量赋值判断是否加载完成。

![image](https://user-images.githubusercontent.com/79617492/219599345-02ee1951-0436-4d89-a8e7-c91ed99fd416.png)

##### 图2-2 是否加载完成

c）是否加载失败：开启该状态后表示加载失败，不再触发加载事件，可绑定变量赋值判断是否加载失败。

![image](https://user-images.githubusercontent.com/79617492/219599365-189e82f2-7a70-4dc3-8725-daad7c26e194.png)

##### 图2-3 是否加载失败

d）触发加载时距离底部的距离（px）：滚动条与底部距离小于该值时触发加载。

![image](https://user-images.githubusercontent.com/79617492/219599393-4883f18e-2280-4ce5-9dd4-da80af4c8b59.png)

##### 图2-4 触发加载时距离底部的距离

e）加载中提示文案：加载过程中提示的文案。

![image](https://user-images.githubusercontent.com/79617492/219599410-a10ba758-a99e-472e-b354-349dc74e6f18.png)

##### 图2-5 加载中提示文案

f）加载完成提示文案：加载完成后提示的文案。

![image](https://user-images.githubusercontent.com/79617492/219599431-4d9d55a9-a217-490f-ba07-49c48e470c0b.png)

##### 图2-6 加载完成提示文案

g）加载失败提示文案：加载失败后提示的文案。

![image](https://user-images.githubusercontent.com/79617492/219599451-ba4836de-2f40-4b5c-bb38-a74ca30b6f59.png)

##### 图2-7 加载失败提示文案

h）动作面板：支持绑定控件滑动到底部时的动作，当符合动作条件时会触发相应的动作。详情见《SoFlu（前端）全自动开发平台教程第3.3.16节至3.3.20节》绑定动作部分。

![image](https://user-images.githubusercontent.com/79617492/219599474-933fc836-6e91-41a7-abb9-77b6289be23e.png)

##### 图2-8 动作面板

#### 4.4.2.2 操作案例

列表上滑加载组件使用瀑布流滚动加载，用于展示长列表，当列表滚动到底部时，会触发事件并加载更多列表项。

#### 4.4.2.2.1 在页面上滑加载数据

前提条件：准备一个能返回分页列表数据的后端接口，数据格式参考如下：

![image](https://user-images.githubusercontent.com/79617492/219599496-ac7f856d-8a51-49f3-b93f-dad93d90c0e0.png)

##### 图2-9 数据格式参考

a）在左侧控件库，拖入一个容器控件，并设置容器高度，再将列表上滑加载控件拖入到容器中。在列表上滑加载控件中，拖入需要展示数据的控件（此处以文本控件为例）。

![image](https://user-images.githubusercontent.com/79617492/219599526-0a5abde8-8caa-47fe-a15d-b52eb9cc0ccb.png)

##### 图2-10 拖入需要展示数据的控件

b）单击上方变量设置，新增四个页面变量，分别是 “index”（初始值为0）、“text”、“textAccount（初始值为[]）” 以及 “a（初始值为false）”。

```
说明：

b1）index：分页页数

b2）text：分页数据

b3）textAccount：列表总数据

b4）a：控制是否加载完成，“true”表示加载完成，“false”表示加载未完成。
```

![image](https://user-images.githubusercontent.com/79617492/219599559-242b575b-5ccc-409e-b7c2-858bb2c8f037.png)

##### 图2-11 新增四个页面变量

c）单击上方页面函数，在函数代码开发页面，新增三个函数，函数及方法参考下图：

```
说明：


c1）pushList(data)： 用于将获取的当前页数据（text）追加到所有列表数据（textAccount）中。

c2）pageIn()： 用于当函数被调用时，当前分页页数（index）自增+1。

c3）lenth()： 用于函数被调用时，判断当前列表是否还有数据，如果没有数据，则判断加载完成（即a为“true”）。
```

![image](https://user-images.githubusercontent.com/79617492/219599581-efcb3321-b415-4103-9393-81e48524db9f.png)

##### 图2-12 函数及方法参考

d）选中列表上滑加载控件，单击右侧属性栏是否加载完成旁的变量绑定按钮，选择页面变量 > a。

![image](https://user-images.githubusercontent.com/79617492/219599612-bb37758e-738a-4150-9dfd-9465557dc96c.png)

##### 图2-13 选择页面变量

e）单击绑定动作 > 当滑动到底部时，在绑定动作页面选择对应的项目和接口。填写或绑定下方带出的接口请求参数。

```
请求参数说明：

e1）第一个参数左边绑定接口请求参数“pageIndex（当前分页页数）”，右边绑定页面函数pageIn()。

e2）第二个参数左边绑定接口请求参数 “pageSize（分页数据）”， 右边手动赋值为 “5”。
```

![image](https://user-images.githubusercontent.com/79617492/219599665-9f3489b1-f8aa-472b-814d-130214aa2299.png)

##### 图2-14 选择对应的项目和接口

![image](https://user-images.githubusercontent.com/79617492/219599689-97680a69-e98d-4e7f-a849-5b08ecc13acf.png)

##### 图2-15 填写或绑定下方带出的接口请求参数

f）在单击响应成功处理旁的新增处理动作，新增三个动作处理，分别是：

```
动作处理说明：

f1）填写判断条件，执行动作选择数据处理，左边绑定页面变量“text”，右边绑定接口响应数据“data.records”，如图2-16所示。

f2）填写判断条件，执行动作选择函数处理，绑定函数“pushList()”，中间参数选择 “text（分页数据）”，如图2-17所示。

f3）填写判断条件，执行动作选择函数处理 ，绑定函数“lenth()”，如图2-18所示。
```

![image](https://user-images.githubusercontent.com/79617492/219599718-da025cc8-067f-499c-a28d-9319bc80a9f9.png)

##### 图2-16 动作处理说明1

![image](https://user-images.githubusercontent.com/79617492/219599746-3e6d52b1-221b-478b-9dc8-beb1401707d4.png)

##### 图2-17 动作处理说明2

![image](https://user-images.githubusercontent.com/79617492/219599774-24e2aeca-25f0-434d-85fe-609f8effeade.png)

##### 图2-18 动作处理说明3

g）选中文本控件，单击右侧属性栏高级 > 循环数据旁的变量绑定按钮，选择页面变量 > textAccount。

![image](https://user-images.githubusercontent.com/79617492/219599793-bc77b34b-5393-49fc-8c77-177c33cf4ba3.png)

##### 图2-19 选择textAccount

h）单击文本控件的属性 > 内容旁的变量绑定按钮，绑定接口中需要展示的循环变量字段，单击循环变量，填写文本的循环变量名“name”。

![image](https://user-images.githubusercontent.com/79617492/219599818-d226fb0f-3433-4d09-8096-ac41397f3375.png)

##### 图2-20 填写文本的循环变量名“name”

i）单击预览，在浏览器预览页面，体验上滑加载列表效果。

##### 说明：当页面加载时，会先显示第一页的数据，往上滑动页面会下载下一页数据直至所有数据都加载完成。

![image](https://user-images.githubusercontent.com/79617492/219599845-4798e943-6d2f-4e18-8e38-d725ab43df87.png)

##### 图2-21 单击预览
