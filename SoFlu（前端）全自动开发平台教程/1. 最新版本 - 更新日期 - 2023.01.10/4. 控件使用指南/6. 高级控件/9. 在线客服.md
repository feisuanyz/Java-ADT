### 4. 控件使用指南

#### 4.6 高级控件

#### 4.6.9 在线客服

可根据需求动态配置聊天的会话框，用户在输入用户的基本信息后，即可实现双向聊天。

#### 4.6.9.1 基本属性

a）角色：可选择需要的角色，分别为“客户”和“客服”两种，不同的角色对应不同的配置和界面。

![image](https://user-images.githubusercontent.com/79617492/226551010-fd262a98-92dc-4ae8-a204-e060a6da045d.png)

##### 图9-1 角色

b）宽/高度：可设置聊天框的宽/高度，需输入以px、%结尾的参数或纯数字。

![image](https://user-images.githubusercontent.com/79617492/226551031-baa78987-1dfe-4422-85c5-92bc8bec4d80.png)

##### 图9-2 宽/高度

c）appid：可输入需要配置发送的用户应用编号。

![image](https://user-images.githubusercontent.com/79617492/226551049-00f00fc3-a664-4807-99a7-81c1849df5f5.png)

##### 图9-3 appid

d）客户/客服编号：可输入当前客户/客服的用户id。

![image](https://user-images.githubusercontent.com/79617492/226551080-86bdde49-6fb6-4605-88b4-ee143daaa928.png)

##### 图9-4 客户/客服编号

e）客户/客服昵称：可输入当前客户/客服的用户昵称。

![image](https://user-images.githubusercontent.com/79617492/226551122-350083c9-ab31-4dd8-9f47-c892f34dca53.png)

##### 图9-5 客户/客服昵称

f）下载资源地址：可输入下载资源的链接。

![image](https://user-images.githubusercontent.com/79617492/226551152-1a2e9851-4206-4dd4-9976-1d377124c99c.png)

##### 图9-6 下载资源地址

g）Socket地址：webSocket请求连接的地址。

![image](https://user-images.githubusercontent.com/79617492/226551174-d6fc6d0b-d6a4-4b43-836c-0f97d2e1993f.png)

##### 图9-7 Socket地址

h）数据映射：可编辑代码编辑数据映射字段。

```
说明：

h1）firstSessionId：首次会话id

h2）sessionId：映射会话id

h3）receiveUser：接收人id

h4）receiveUserName：接收人姓名

h5）sendUser：发送人id

h6）sendUserName：发送人姓名

h7）customerId：客户编号，只有角色为客服的时候生效，用于请求历史聊天记录接口入参

h8）fileStream：文件流
```

![image](https://user-images.githubusercontent.com/79617492/226551195-d11e35a5-fb79-4be2-8fcd-dd4abc4c7429.png)

##### 图9-8 数据映射

i）每页条数：可在客服角色界面中，设置客户列表每页显示的条数。

![image](https://user-images.githubusercontent.com/79617492/226551292-0cd7b724-9816-4534-b8e1-40807eb9d44e.png)

##### 图9-9 每页条数

j）动作面板：支持绑定控件不同的角色动作，当符合条件时，会触发相应动作。详情见《SoFlu（前端）全自动开发平台教程第3.3.16节至第3.3.20节》绑定动作部分。


```
说明：

j1）获取客户列表：选中后，当用户选择的是客服的时候，该事件才会执行，渲染左边用户列表，获取当前客服聊天的客户列表，当选择用户角色为客服的时候，才会被调用

j2）获取聊天记录：选中后，当进入页面的时候会直接请求数据，渲染会话框,当角色为"客服"时,才会被调用,该接口只会请求一次

j3）更新聊天已读：选中后，当进入页面时会直接请求一次当前选中的用户列表,当该客户列表有未读消息时，点击用户列表会直接执行此接口

j4）获取素材资源：选中后，当进入页面的时候会请求数据，渲染表情资源列表

j5）上传照片资源：选中后,当点击照片聊天时,照片会上传到该储存地址,即发送消息为照片时的保存地址

j6）获取快捷话术语：选中后,当进入页面的时候会请求数据，渲染快捷语列表

j7）更新客服是否关闭会话：客服必选,选中后,当进入页面的时候会请求数据，设置标志位,成功之后才会建立socket连接
```

![image](https://user-images.githubusercontent.com/79617492/226551319-afb9d53c-bed4-49db-a3de-dbd1d42528d9.png)

##### 图9-10 动作面板

#### 4.6.9.2 在线客服

案例介绍如何新增客服/客户聊天页面。

#### 4.6.9.2.1 新增客服/客户聊天页面

a）在左侧控件库拖入一个在线客服控件到右侧画布。

![image](https://user-images.githubusercontent.com/79617492/226551392-f5d19d23-6159-4ba5-b46e-7b28c20c605d.png)

##### 图9-11 拖入控件

b）在右侧属性栏中，配置基本的控件属性，配置完成后单击下方的绑定动作 > 获取快捷话术语。

##### 说明：此处以客服界面为例，客服界面属性与客户界面属性的设置基本一致，不同的是在选择角色时需要选择“客服角色”并且支持设置每页显示客户列表的条数，具体属性定义可见上方的基本属性说明。

![image](https://user-images.githubusercontent.com/79617492/226551422-9851ae4e-5afb-49d3-9554-665f5a886ad3.png)

##### 图9-12 单击获取快捷话术语

c）在绑定动作页面，绑定对应的快捷话术语接口和项目，配置完成后单击确定。

![image](https://user-images.githubusercontent.com/79617492/226551472-ba06f205-9959-4038-ba69-580f26c4c370.png)

##### 图9-13 绑定对应的快捷话术语接口和项目

d）单击预览，在浏览器预览页面的在线客服控件中体验客服聊天框效果并单击输入框上方的“消息”图标，选择快捷术语进行回复。

![image](https://user-images.githubusercontent.com/79617492/226551483-23ebb107-7856-4e28-822d-7e6533636351.png)

##### 图9-14 单击预览
