### 4. 操作指南

#### 4.13 接口管理

#### 4.13.6 集成监控接口

#### 4.13.6.3 集成influxdb数据库监控接口

全自动开发平台集成监控系统支持集成influxdb数据库实现对接口数据的监控。influxdb是一个开源的时序数据库，使用GO语言开发，特别适合用于处理和分析资源监控数据这种时序相关的数据，而influxdb自带的各种特殊函数如求标准差、随机取样数据、统计数据变化比等，使数据统计和实时分析变得十分方便。

本节将介绍如何配置influxdb数据库实现接口监控。

##### 注意：只有在安装本地客户端或者部署项目时才可以配置influxdb数据库实现接口监控。

#### 4.13.6.3.1 前提条件

您需要下载并解压本地客户端安装包或者执行引擎包，具体可参见《SoFlu（后端）全自动开发平台教程第2.9节：如何部署项目》或《SoFlu（后端）全自动开发平台教程第2.10节：安装本地客户端》。

#### 4.13.6.3.2 操作步骤

a）在本地客户端安装包或执行引擎包路径下配置application.yml文件（路径下若未该文件，则需新建一个该文件），打开接口监控开关同时配置数据库信息，application.yml文件的具体配置如下：

```
#健康检查开关配置
management:
    server:
        #默认的监控信息查看端口配置
        port:9091
    metrics:
        #监控信息同步导出到influxdb中的配置
        export:
            influx:
                #是否同步开关（值为true时即可开启同步）
                enabled: true
                # influxdb同步地址
                uri: http://ip:port
                # influxdb同步库名
                db: flowcore_influxdb_dev
                # influxdb用户名
                user-name: admin
                # influxdb密码
                password: admin

# 监控信息上报开关(控制执行引擎中的所有项目是否上报监控信息的总开关)
metrics-report:
    enable: true
```

b）启动本地客户端或者本地执行引擎项目。

![输入图片说明](../../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/4.%20%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/6.%20%E9%9B%86%E6%88%90%E7%9B%91%E6%8E%A7%E6%8E%A5%E5%8F%A3/3-1.png)

##### 图3-1 启动本地客户端

c）打开接口的监控开关及字段采集数据。

![输入图片说明](../../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/4.%20%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/6.%20%E9%9B%86%E6%88%90%E7%9B%91%E6%8E%A7%E6%8E%A5%E5%8F%A3/3-2.png)

##### 图3-2 打开接口的上报开关

![输入图片说明](../../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/4.%20%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/6.%20%E9%9B%86%E6%88%90%E7%9B%91%E6%8E%A7%E6%8E%A5%E5%8F%A3/3-3.png)

##### 图3-3 打开接口的监控开关

d）运行接口即可开启接口监控数据采集。

e）通过工具（如示例工具xshell）连接上配置文件中的infludb数据库，查看数据库中监控到的接口信息。

![输入图片说明](../../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/4.%20%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/6.%20%E9%9B%86%E6%88%90%E7%9B%91%E6%8E%A7%E6%8E%A5%E5%8F%A3/3-4.png)

##### 图3-4 查看数据库中监控到的接口信息

f）输入命令influx连接，可以看到当前数据口连接的版本和地址。

![输入图片说明](../../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/4.%20%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/6.%20%E9%9B%86%E6%88%90%E7%9B%91%E6%8E%A7%E6%8E%A5%E5%8F%A3/3-5.png)

##### 图3-5 输入命令influx连接

g）输入命令auth，登录数据库的账户密码（该账号密码需与application.yml配置文件中的数据库连接信息保持一致）。

![输入图片说明](../../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/4.%20%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/6.%20%E9%9B%86%E6%88%90%E7%9B%91%E6%8E%A7%E6%8E%A5%E5%8F%A3/3-6.png)

##### 图3-6 登录数据库的账户密码

h）输入命令show databases，显示所有数据库信息。

![输入图片说明](../../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/4.%20%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/13.%20%E6%8E%A5%E5%8F%A3%E7%AE%A1%E7%90%86/6.%20%E9%9B%86%E6%88%90%E7%9B%91%E6%8E%A7%E6%8E%A5%E5%8F%A3/3-7.png)
