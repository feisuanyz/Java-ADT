### 5. 案例场景

#### 5.2 常见案例

#### 5.2.6 系统站内信推送

系统推送站内信是系统开发中比较常用的功能，后端实现推送站内信的功能是将数据存储到数据库中（新增系统消息表），以方便前端页面调用数据，本节讲述如何使用全自动开发平台开发系统站内信后端功能。

#### 5.2.6.1 效果展示

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/image.png)

##### 图1-1 效果展示

上图是APP消息模块推送手工消息的界面展示效果，对于后端开发来说，只需要将数据存储到<系统消息表>中即可，如下图所示：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-2.png)

##### 图1-2 系统消息表

#### 5.2.6.2 准备工作

需提前准备功能实现过程中用到的两张数据表：消息推送节点表 bs_message_node（用来存储消息模版消息）、系统消息表sy_message（用来存储推送消息），表结构设计及相关数据如下图所示。

a）消息推送节点表 bs_message_node

```
CREATE TABLE `bs_message_node` (
  `send_node_id` varchar(50) NOT NULL COMMENT '推送节点编号',
  `send_node_name` varchar(100) DEFAULT NULL COMMENT '推送节点名称',
  `send_context` varchar(200) DEFAULT NULL COMMENT '推送内容',
  `message_title` varchar(200) DEFAULT NULL COMMENT '消息标题',
  `message_type` int(11) DEFAULT NULL COMMENT '消息类型',
  `goto_type` int(11) DEFAULT NULL COMMENT '跳转类别',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`send_node_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='消息推送节点表';
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-3.png)

##### 图1-3 表结构及相关信息

b）系统消息表sy_message

```
CREATE TABLE `sy_message` (
  `msg_id` varchar(24) COLLATE utf8_bin NOT NULL COMMENT '消息编号',
  `is_readed` int(11) DEFAULT NULL COMMENT '是否已查阅',
  `title` varchar(100) COLLATE utf8_bin DEFAULT NULL COMMENT '消息标题',
  `context` varchar(100) COLLATE utf8_bin DEFAULT NULL COMMENT '消息内容',
  `message_type` int(11) DEFAULT NULL COMMENT '消息类型',
  `goto_type` int(11) DEFAULT NULL COMMENT '跑转类别',
  `relation_id` varchar(24) COLLATE utf8_bin DEFAULT NULL COMMENT '关联编号',
  `receive_user` varchar(24) COLLATE utf8_bin DEFAULT NULL COMMENT '接收人',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `create_user` varchar(24) COLLATE utf8_bin DEFAULT NULL COMMENT '创建人',
 PRIMARY KEY (`msg_id`)
 )ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='系统消息表';
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-4.png)

##### 图1-4 表结构及相关信息

#### 5.2.6.3 流程图设计概述

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-5.png)

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-6.png)

##### 图1-5/6 流程图

逻辑概述：

a）系统消息分为系统自动发送的消息和管理员手工发送的消息，通过sendNodeId(推送节点编号)来判断推送消息方式，为空发送手工消息，不为空发送模版消息。

b）发送手工消息时，通过赋值组件对SyMessage实体模型字段进行赋值，然后调用新增SQL对表进行批量新增操作。

c）发送模版消息时，需要先根据sendNodeId(推送节点编号)查询<消息推送节点表 bs_message_node>中的message_title、message_type、send_context、goto_type字段信息。

d）使用按模板生成文本内容函数，将查询到的send_context内容中的‘{}’参数用入参params参数列表替换文本，然后赋值到SyMessage实体模型，根据不同接收人，将各个不同map放到一个初始化list中，最后执行批量新增SQL操作。

#### 5.2.6.4 技术要点概述

本实例涉及单函数、多函数、互斥条件、计数器、单SQL等组件，需要对参数进行处理后赋值给<系统消息表>的实体模型，最后执行新增操作，功能实现需要下列函数支持：

```
newList()：创建一个List；

splitStrToListString(String,String) ：将字符串按分隔符转换为List；

listSize(List) ：取List大小；
newMapPutAll(Map sourceMap) ：将源MAP全量赋值一个新MAP中；

listAddValue(List fromList,Map addMap)： 将MAP添加到List到末尾；

newMapInit(Object[])：新建Map，初始化字段值；

jsonStrToMap(String json)： JSON转Map；

getTextByTemplate(String msgTemplate,Map paramsValue)：按模板生成文本内容。
```

#### 5.2.6.5 全自动开发平台具体操作过程

#### 5.2.6.5.1 创建实体模型

进入全自动开发平台“实体模型”功能模块，创建SyMessage（系统信息）实体模型，用于后续系统信息的赋值操作。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-7.png)

##### 图1-7 点击实体模型

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-8.png)

##### 图1-8 创建SyMessage（系统信息）实体模型

##### 注意：若对于如何新增实体模型不清晰，可参见《SoFlu（后端）全自动开发平台教程第16.2节：实体模型》。

#### 5.2.6.5.2 创建接口：新增站内信推送

a）接口管理：新增接口(配置接口名称、路径等基本信息)

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-9.png)

##### 图1-9 点击接口管理

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-10.png)

##### 图1-10 配置基本信息

b）接口入参：配置请求参数、头部参数(按下列参数列表新增参数)

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-11.png)

##### 图1-11 配置请求参数

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-12.png)

##### 图1-12 配置头部参数

#### 5.2.6.5.3 模型编辑

通过拖拽左侧组件列表中所需的组件进行模型编辑（即流程图编辑）。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-13.png)

##### 图1-13 进入模型编辑

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-14.png)

##### 图1-14 进行模型编辑

#### 5.2.6.5.4 组件的具体配置

a）使用单函数组件调用函数，处理请求参数

a1）调用newArrayList()函数创建一个List，创建一个ArrayList。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-15.png)

##### 图1-15 创建一个ArrayList

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-16.png)

##### 图1-16 填写数据

a2）调用splitStrToListString(String sourceStr,String splitStr)函数将请求参数receiveUser按分隔符“,”进行切割，并转换为List。

##### 说明：这里需要做切割是因为可能有多个接收人。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-17.png)

##### 图1-17 切割及转换类型

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-18.png)

##### 图1-18 填写数据

a3）调用listSize(List sourceList)函数获取接收人List大小，即接收人的个数。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-19.png)

##### 图1-19 获取接收人List大小

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-20.png)

##### 图1-20 填写数据

b）使用互斥条件组件判断推送消息方式

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-21.png)

##### 图1-21 判断流程

通过接口参数sendNodeId(推送节点编号)来判断推送消息方式，若sendNodeId为空，则推送手工消息；若sendNodeId不为空，则推送模版消息。

手工消息流转条件：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-22.png)

##### 图1-22 手工消息流转条件

模板消息流转条件：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-23.png)

##### 图1-23 模板消息流转条件

c）推送手工消息相关流程

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-24.png)

##### 图1-24 推送手工消息相关流程

c1）使用计数器组件对手工信息进行计数，需传入接收人List大小，操作符选择递增。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-25.png)

##### 图1-25 手工消息计数器组件

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-26.png)

##### 图1-26 计数器介绍

c2）使用互斥条件组件判断是否继续推送手工消息循环，若手工消息计数器当前索引值小于接收人List大小，则继续推送手工消息循环；若手工消息计数器当前索引值大于等于接收人List大小，则退出推送手工消息循环，执行批量新增操作。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-27.png)

##### 图1-27 判断流程

继续推送手工消息循环的流转条件：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-28.png)

##### 图1-28 继续推送手工消息循环的流转条件

退出推送手工消息循环的流转条件：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-29.png)

##### 图1-29 退出推送手工消息循环的流转条件

c3）使用赋值条件组件为手工消息赋值，数据模型为开始时创建的SyMessage实体模型。

##### 注意：receiveUser的参数值引用的是${单函数组件编号[计数器组件编号]}，其中单函数组件为【切割并转换接收人receiveUser类型】，计数器组件为手工消息计数器。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-30.png)

##### 图1-30 为手工消息赋值

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-31.png)

##### 图1-31 赋值组件

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-32.png)

##### 图1-32 填写模型数据

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-33.png)

##### 图1-33 单函数

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-34.png)

##### 图1-34 计数器

c4）使用多函数组件调用函数newMapPutAll(Map)将源Map全量赋值一个新Map中，入参引用上一步赋值组件【赋值手工消息】SyMessage实体模型的值，设置结果标识“message”便于对该函数值的引用；同时调用函数listAddValue(List fromList,Map addMap)将记录1函数返回的Map添加到初始化List末尾处，入参选取初始化List以及记录1函数的结果标识“message”。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-35.png)

##### 图1-35 赋值Map追加List

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-36.png)

##### 图1-36 数据列表1

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-37.png)

##### 图1-37 数据列表2

d）推送模板消息相关流程

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-38.png)

##### 图1-38 推送模板消息相关流程

d1）使用单函数组件调用newMapInit(Object[] keyAndValue)构建查询参数sendNodeId。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-39.png)

##### 图1-39 构建查询参数sendNodeId

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-40.png)

##### 图1-40 填写数据

d2）使用单SQL组件查询《消息推送节点表》中对应推送节点编号sendNodeId的记录，具体SQL内容如下。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-41.png)

##### 图1-41 使用单SQL组件查询

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-42.png)

##### 图1-42 填写数据

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-43.png)

##### 图1-43 SQL内容

##### 注意：若对于如何新增SQL语句不清晰，可参见《SoFlu（后端）全自动开发平台教程第2.5节：新增SQL》。

d3）使用多函数组件调用函数jsonStrToMap(String)将Json字符串转换为Map，需传入接口入参params（参数列表），并设置结果标识“params”便于函数值的引用；同时调用按模板生成文本内容函数getTextByTemplate(String,Map)进行模板信息替换，替换示例如下图所示，传入的参数为单SQL组件【查询《消息推送节点表》】查询记录中send_context的值以及记录1函数结果标识“params”，并勾选上作为输出结果。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-44.png)

##### 图1-44 替换规范消息模板

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-45.png)

##### 图1-45 数据列表1

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-46.png)

##### 图1-46 数据列表2

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-47.png)

##### 图1-47 文本函数参数介绍

d4）使用计数器组件作为推送模板计数器，循环流程变量为接收人List大小，操作符选择递增。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-48.png)

##### 图1-48 推送模板计数器

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-49.png)

##### 图1-49 计数器

d5）使用互斥条件组件判断是否继续推送模板消息循环，若推送模板计数器当前索引值小于接收人List大小，则继续推送模板消息循环；若推送模板计数器当前索引值大于等于接收人List大小，则退出推送模板消息循环，执行批量新增操作。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-50.png)

##### 图1-50 判断流程

继续推送模板消息循环的流转条件：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-51.png)

##### 图1-51 流转条件

退出推送模板消息循环的流转条件：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-52.png)

##### 图1-52 流转条件

d6）使用赋值条件组件将模板的内容赋值到SyMessage实体模型中，其中context参数值引用多函数组件【替换规范消息模板】的执行结果，即文本模板消息；relationId、createUser参数值引用接口参数的值；其它字段通过单SQL组件【查询《消息推送节点表》】查询出的对应字段值进行赋值。

##### 注意：receiveUser的参数值引用的是${单函数组件编号[计数器组件编号]}，与手工消息流程中的赋值组件类似，其中单函数组件为【切割并转换接收人receiveUser类型】，计数器组件为推送模板计数器。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-53.png)

##### 图1-53 赋值模板消息

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/2.%20%E5%B8%B8%E8%A7%81%E6%A1%88%E4%BE%8B/6.%20%E7%B3%BB%E7%BB%9F%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A8%E9%80%81/1-54.png)

##### 图1-54 赋值组件
