### 5. 案例场景

#### 5.4 综合案例

#### 5.4.2 发送短信验证码

本节实例是结合腾讯云实现发送短信验证码的功能，全自动开发平台不仅可以在平台内部实现功能开发，还可以与外部工具联用以实现用户各种各样的功能需求，体现了全自动开发平台灵活包容、便捷好用的功能特点。实例主要用到了平台的单函数组件、单SQL组件、互斥条件组件，这三种组件的结合也是一种经典搭配，可适用于多种不同的案例场景，同时通过调用平台中的系统函数或自定义函数来实现特定功能。

#### 5.4.2.1 效果展示

通过调用发送短信验证码接口，传入接收短信验证码的手机号，即可实现对指定手机号发送短信验证码的功能，如下图所示。

![image](https://user-images.githubusercontent.com/79617492/207240161-18eb35b7-b239-472a-a921-2ea22d4ae55b.png)

##### 图2-1 传入接收短信验证码的手机号

![image](https://user-images.githubusercontent.com/79617492/207240173-bb053349-1f18-4de5-9b54-808c66e43b8c.png)

##### 图2-2 效果展示

#### 5.4.2.2 准备工作

a）提前准备一个开通了短信服务的腾讯云账号，关于如何注册腾讯云账号及开通短信服务可参见[腾讯云文档](https://cloud.tencent.com/document/product/382/37745)(文档中心 > 短信 > 国内短信 > 国内短信快速入门)。

b）提前准备功能实现过程中需要使用到的两张数据表：参数表sy_params（用来配置获取验证码次数上限和验证码有效时长的参数信息）、短信表user_note（用来存储用户手机号、发送短信次数、发送短信时间及短信验证码等信息），表结构设计及相关数据如下图所示。

参数表sy_params：

```
CREATE TABLE `sy_params` (
  `param_id` varchar(24) NOT NULL COMMENT '参数编号',
  `param_remark` varchar(100) DEFAULT '' COMMENT '参数说明',
  `param_value` varchar(50) DEFAULT '' COMMENT '参数值',
  `data_type` varchar(6) DEFAULT '' COMMENT '数据类型',
  `create_user` varchar(24) DEFAULT '' COMMENT '创建人',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
 `update_time` datetime DEFAULT NULL COMMENT '更新时间',
  `update_user` varchar(24) DEFAULT NULL COMMENT '更新人',
  PRIMARY KEY (`param_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='参数表';
```

![image](https://user-images.githubusercontent.com/79617492/207240196-4d3e25cd-0687-4b92-afd4-49d19e71012b.png)

##### 图2-3 表结构设计及相关数据

##### 说明：参数表中的配置信息可自行设置，本案例主要配置了verificationCodeDuration 【验证码有效时长（分钟）】和todayVerification【当天获取验证码次数上限】。

短信表user_note：

```
CREATE TABLE `user_note` (
  `mobileSms_id` varchar(255) NOT NULL COMMENT '短信记录Id',
  `receiver_mobile` varchar(255) DEFAULT '' COMMENT '手机号',
  `dayNum` int(11) DEFAULT NULL COMMENT '当天获取验证码次数',
  `create_time` datetime DEFAULT NULL COMMENT '验证码发送时间',
  `verify_code` varchar(255) DEFAULT '' COMMENT '发送的验证码'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='短信表';
```

![image](https://user-images.githubusercontent.com/79617492/207240227-63e2b9db-ab41-481f-9603-c8ab93042b46.png)

##### 图2-4 表结构设计及相关数据

##### 说明：短信表中的数据在调用接口后自动生成。

c）需进入腾讯云短信控制台拿到相关短信参数，放入全自动开发平台配置组管理中，具体如下图所示。

![image](https://user-images.githubusercontent.com/79617492/207240243-d6859e8b-af11-4199-a67d-fe0e0e05143b.png)

##### 图2-5 配置相关短信参数

##### 说明：此处的参数字段分别为secretId（腾讯云密钥secretId）、secretKey（腾讯云密钥secretId）、smsSdkAppId（腾讯云密钥AppId）、sign（签名）、templateID（短信模板Id），其参数值均可以在腾讯云短信控制台拿到。因本案例需与腾讯云结合使用，具体的参数值均需要用户自行创建密钥、签名及短信正文模板后获取，创建方式可参见[腾讯相关文档](https://cloud.tencent.com/document/product/382/37745)（文档中心 > 短信 > 国内短信 > 国内短信快速入门）。

![image](https://user-images.githubusercontent.com/79617492/207240266-5a16b3a8-507e-4737-add1-37fbc811628d.png)

##### 图2-6 获取腾讯云密钥

![image](https://user-images.githubusercontent.com/79617492/207240280-1e0a6796-2d1b-42a3-821d-a3cd8e258204.png)

##### 图2-7 获取签名参数值

![image](https://user-images.githubusercontent.com/79617492/207240288-778c0e77-d3e2-417b-ba4d-769428ba3afa.png)

##### 图2-8 获取短信模板id参数值

##### 注意：若对于如何新增配置组不清晰，可参见《SoFlu（后端）全自动开发平台教程第4.17.1节：新增配置组》。

#### 5.4.2.3 流程图设计概览

![image](https://user-images.githubusercontent.com/79617492/207240316-5465f1d8-8af2-4efd-bdaa-e2a04f4f6b2b.png)

![image](https://user-images.githubusercontent.com/79617492/207240328-53d0f450-d8ed-4c7e-9118-b8116ed3a9ce.png)

##### 图2-9/10 流程图设计概览

逻辑描述：

a）在【参数表】查询【当天获取验证码次数上限】。

b）在【短信表】查询当前手机号当天获取验证码的次数。

c）判断当前手机号【当天获取验证码次数】的值是否为空，若为空，则进行新增操作，新增一条发送短信记录；若不为空，继续以下流程。

d）再次查询【短信表】，获取【当前手机号当天获取验证码的次数】

e）判断【当前手机号当天获取验证码的次数】是否小于【当天获取验证码次数上限】，若大于等于，说明今日已超过验证码发送次数限制，将输出发送失败信息；若小于，则继续以下流程。

f）生成短信验证码。

g）为当前手机号加上中国大陆地区手机标识【+86】。（因为本案例仅针对国内手机号验证码发送）

h）给指定手机号发送验证码信息。

i）更新当前手机号短信表中的内容，即当前手机号验证码发送次数、验证码发送时间、当前发送的验证码信息。

j）输出验证码发送成功信息。

#### 5.4.2.4 全自动开发平台具体操作过程

#### 5.4.2.4.1 新增发送短信验证码接口

a）进入全自动开发平台“接口管理”功能模块，新增接口模块并新增一个接口，填写接口的基本信息。

![image](https://user-images.githubusercontent.com/79617492/207240340-82e07ef6-4c39-4d6b-8d03-3881ab8d2ff5.png)

##### 图2-11 点击“接口管理”

![image](https://user-images.githubusercontent.com/79617492/207240358-9f15d71d-4a14-424f-b921-88a5b59ea130.png)

##### 图2-12 填写接口的基本信息

#### 5.4.2.4.2 配置接口的入口参数

a）此处需配置一个String类型的参数receiverMobile作为接收验证码的手机号。

![image](https://user-images.githubusercontent.com/79617492/207240372-e041400e-41ae-432a-8156-66e88d51e2d4.png)

##### 图2-13 配置一个String类型的参数receiverMobile

#### 5.4.2.4.3 模型编辑

a）通过拖拽左侧组件列表中所需的组件进行模型编辑（即流程图编辑）。

![image](https://user-images.githubusercontent.com/79617492/207240644-54f3de6f-d781-4b69-8686-0e29ba2dfa7a.png)

##### 图2-14 进入模型编辑

![image](https://user-images.githubusercontent.com/79617492/207240660-8f99730c-7164-4cf5-8f0c-f5cbf53a2c44.png)

##### 图2-15 进行模型编辑

#### 5.4.2.4.4 组件的具体配置（按逻辑描述展示）

a）在【参数表】查询【当天获取验证码次数上限】。

a1）使用单函数组件调用函数newMapInit(Object[] keyAndValue)构造查询参数【paramId】，需传入参数值todayVerification，在参数表中表示【当天获取验证码次数上限】。

![image](https://user-images.githubusercontent.com/79617492/207240682-c475ed6c-ce37-4376-bdf9-756edd1b1059.png)

##### 图2-16 构造查询参数【paramId】

![image](https://user-images.githubusercontent.com/79617492/207240699-7c7bc328-4913-4525-983c-b7b9eeed7547.png)

##### 图2-17 填写数据

a2）使用单SQL组件在【参数表】查询【当天获取验证码次数上限】，具体SQL内容如下，需传入上一步构建的查询参数【paramId】。

![image](https://user-images.githubusercontent.com/79617492/207240713-1f238b6f-79cd-44a3-8c24-7ed48bd448e1.png)

##### 图2-18 查询【当天获取验证码次数上限】

![image](https://user-images.githubusercontent.com/79617492/207240725-6f757850-3e9e-4657-b694-2e57999ebf82.png)

##### 图2-19 填写数据

![image](https://user-images.githubusercontent.com/79617492/207240743-7169317a-bd7d-4203-9e4b-62be30b8c641.png)

##### 图2-20 SQL内容

##### 注意：若对于如何新增SQL语句不清晰，可参见《SoFlu（后端）全自动开发平台教程第2.5章：新增SQL》。

b）在【短信表】查询当前手机号当天获取验证码的次数。

b1）使用单函数组件调用函数getCurrDate()获取当前日期。

![image](https://user-images.githubusercontent.com/79617492/207240757-60a8fc35-700c-4a57-9c23-71e776ee923c.png)

##### 图2-21 获取当前日期

![image](https://user-images.githubusercontent.com/79617492/207240770-d6550dd4-3a3a-4ab4-818b-fd4b8d3d20f1.png)

##### 图2-22 填写数据

b2）使用单函数组件调用函数newMapInit(Object[] keyAndValue)构造查询参数【手机号】【当前日期】，需传入参数receiverMobile（接收验证码的手机号）以及上一步获取到的createTime（当前日期）。

![image](https://user-images.githubusercontent.com/79617492/207240784-8a9b2000-9212-4ece-b3ee-ad24b1763866.png)

##### 图2-23 构造查询参数【手机号】【当前日期】

![image](https://user-images.githubusercontent.com/79617492/207240797-f49f554b-9e0b-47a2-91dc-f24bf4ae9356.png)

##### 图2-24 填写数据

b3）使用单SQL组件根据手机号及当前日期在【短信表】查询【当天获取验证码次数】，具体的SQL内容如下，需传入上一步构建的查询参数【手机号】及【当前日期】。

![image](https://user-images.githubusercontent.com/79617492/207240809-85c5806a-3961-4101-8793-19dd74ecfe33.png)

##### 图2-25 查询【当天获取验证码次数】

![image](https://user-images.githubusercontent.com/79617492/207240828-503f8c05-df23-4d97-89a4-0036ec68fe57.png)

##### 图2-26 填写数据

![image](https://user-images.githubusercontent.com/79617492/207240840-95716979-01c5-4c26-aa8f-53576f2ae209.png)

##### 图2-27 SQL内容

c）判断当前手机号【当天获取验证码次数】的值是否为空，若为空，则进行新增操作，新增一条发送短信记录；若不为空，继续以下流程。

c1）使用单函数组件调用函数getCurrDateTime()获取当前系统时间，用于后续新增发送短信记录。

![image](https://user-images.githubusercontent.com/79617492/207240860-770c59b3-3582-4a9f-b4cd-a89bec668f54.png)

##### 图2-28 获取当前系统时间

![image](https://user-images.githubusercontent.com/79617492/207240888-e8efbf48-a9d9-4eb2-a257-2453e1e553a9.png)

##### 图2-29 填写数据

c2）使用互斥条件组件来判断【当天获取验证码次数】的值是否为空，若为空，则使用单函数组件调用newMapInit(Object[] keyAndValue)构造新增参数mobileSmsId（短信记录Id，根据函数getUuid()获取）、receiverMobile（接收验证码的手机号）、createTime（当前系统时间）。

![image](https://user-images.githubusercontent.com/79617492/207240907-e56d6a9f-a88c-4bc6-90dd-0b55198bdd75.png)

##### 图2-30 判断流程

![image](https://user-images.githubusercontent.com/79617492/207240917-47581afc-18f1-4007-8294-469f49d39d71.png)

##### 图2-31 流转条件

![image](https://user-images.githubusercontent.com/79617492/207240954-ce458586-357f-4439-b09d-d441f3b3bcff.png)

##### 图2-32 填写数据（1-3）

![image](https://user-images.githubusercontent.com/79617492/207240967-d1aaf795-e78b-42e6-a7bb-4f17642608ae.png)

##### 图2-33 填写数据（4-6）

c3）使用单SQL组件在【短信表】新增发送短信记录，具体SQL内容如下，需传入上一步构建的新增参数。

![image](https://user-images.githubusercontent.com/79617492/207240981-4f841562-8547-471c-a037-37dc41bb5f31.png)

##### 图2-34 在【短信表】新增发送短信记录

![image](https://user-images.githubusercontent.com/79617492/207241003-71766172-45ef-43c2-a272-8ac546b4ced6.png)

##### 图2-35 填写数据

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-36.png)

##### 图2-36 SQL内容

c4）若不为空，则使用单函数组件调用函数strToInt(String sourceValue)将参数表中【param_value】转为整型，即将参数表中【当天获取验证码次数上限】的参数类型由字符型转为整型，便于后续修改短信表中增加获取验证码次数的操作。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-37.png)

##### 图2-37 不为空的情况

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-38.png)

##### 图2-38 流转条件

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-39.png)

##### 图2-39 填写数据

d）再次使用单SQL组件，根据当前手机号及当前时间查询【短信表】获取【当前手机号当天获取验证码的次数】，具体SQL信息如下（此处再次查询短信表是由于新增操作后短信表有更新）。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-40.png)

##### 图2-40 获取【当前手机号当天获取验证码的次数】

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-41.png)

##### 图2-41 填写数据

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-42.png)

##### 图2-42 SQL内容

e）使用互斥条件组件判断【当前手机号当天获取验证码的次数】是否小于【当天获取验证码次数上限】，若大于等于，说明今日已超过验证码发送次数限制，将输出发送失败信息；若小于，则继续以下流程。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-43.png)

##### 图2-43 判断流程

【当前手机号当天获取验证码的次数】大于等于【当天获取验证码次数上限】时：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-44.png)

##### 图2-44 流转条件

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-45.png)

##### 图2-45 填写数据

【当前手机号当天获取验证码的次数】小于【当天获取验证码次数上限】时：

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-46.png)

##### 图2-46 流转条件

f）使用单函数组件生成短信验证码，此处使用的函数为获取范围内随机数函数

getRandomByRange(Long rangeBegin,Long rangeEnd)，传入参数1000、10000用于获取四位数短信验证码。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-47.png)

##### 图2-47 生成短信验证码

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-48.png)

##### 图2-48 填写数据

g）使用单函数组件为当前手机号加上中国大陆地区手机标识【+86】，使用的函数为拼接字符串函数concatStrs(String[] strs)，需传入字符串“+86”以及接口入参“receiverMobile”（因为本案例仅针对国内手机号验证码发送，故需要进行该操作）。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-49.png)

##### 图2-49 为当前手机号加上中国大陆地区手机标识【+86】

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-50.png)

##### 图2-50 填写数据

h）给指定手机号发送验证码信息。

h1）使用单函数组件构建发送验证码信息请求参数，此处需用到配置组的参数信息secretId、secretKey、templateID、smsSdkAppid、sign，以及加上中国大陆标识的手机号phoneNumberSet和验证码templateParamSet。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-51.png)

##### 图2-51 构建发送验证码信息请求参数

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-52.png)

##### 图2-52 填写数据（记录1-5）

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-53.png)

##### 图2-53 填写数据（记录5-10）

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-54.png)

##### 图2-54 填写数据（记录11-14）

h2）使用单函数组件调用函数sendMessage(Map params)发送短信息，需传入上一步构造的请求参数。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-55.png)

##### 图2-55 发送验证码信息

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-56.png)

##### 图2-56 填写数据

i）更新当前手机号短信表中的内容，即当前手机号验证码发送次数、验证码发送时间、当前发送的验证码信息。

使用单函数组件调用函数newMapInit(Object[] keyAndValue)构建修改短信表的请求参数，需传入参数receiverMobile（接收验证码手机号）、verifyCode（验证码）、createTime（当前系统时间）以及createTime1（当前日期）。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-57.png)

##### 图2-57 构建修改短信表的请求参数

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-58.png)

##### 图2-58 函数数据（记录1-4）

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-59.png)

##### 图2-59 函数数据（记录5-8）

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-60.png)

##### 图2-60 修改短信表

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-61.png)

##### 图2-61 填写数据

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-62.png)

##### 图2-62 SQL内容

j）使用输出结果组件输出验证码发送成功信息。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-63.png)

##### 图2-63 输出【发送成功】结果

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-64.png)

##### 图2-64 填写数据

#### 5.4.2.4.5 退出窗体视图

a）流程图设计完成后，保存并退出窗体视图。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-65.png)

##### 图2-65 保存并退出窗体视图

#### 5.4.2.4.6 提交并发布接口

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-66.png)

##### 图2-66 提交并发布接口

#### 5.4.2.4.7 测试用例

a）对接口进行测试用例，检验接口实现的功能是否可以达到预期。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-67.png)

##### 图2-67 对接口进行测试用例

b）填写接收验证码的手机号，并启用可视化日志（便于查看接口流程中的数据流转），再单击执行即可。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-68.png)

##### 图2-68 填写手机号并启用可视化日志

c）通过测试用例响应内容查看接口的执行结果，同时查看填写的接收验证码的手机号是否接收到验证码信息。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-69.png)

##### 图2-69 查看接口的执行结果

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-70.png)

##### 图2-70 接收验证码信息

d）若测试用例的结果出现错误或没收到验证码信息，可通过可视化日志双击查看各个组件的节点数据进行接口的调试。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-71.png)

##### 图2-71 点击可视化日志

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-72.png)

##### 图2-72 可视化日志

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/5.%20%E6%A1%88%E4%BE%8B%E5%9C%BA%E6%99%AF/4.%20%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/2-73.png)

##### 图2-73 查询节点数据
