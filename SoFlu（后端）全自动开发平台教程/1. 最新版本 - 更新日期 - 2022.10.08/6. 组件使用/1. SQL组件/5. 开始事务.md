### 6. 组件使用

#### 6.1 SQL组件

#### 6.1.5 开始事务

当接口流程图中需要执行多个SQL组件时，为了防止其中有任意一个SQL组件执行出现异常，导致前面已执行通过的SQL组件所产生的数据成为脏数据，这时可使用事务组件进行回滚操作，回到未执行前的状态。开始事务是事务组件的开始节点，需要和提交事务配合使用，在开始事务和提交事务之间，可以放置SQL组件，事务组件只针对SQL组件

#### 6.1.5.1 前提条件

项目中已加载“开始事务”组件。

#### 6.1.5.2 操作步骤

a）在流程编辑器 > 左侧组件列表 > “SQL”分类下，将 “开始事务” 组件，拖拽至绘图面板，连接好组件的流程图。

##### 说明：事务组件必须是以“开始事务”为始，到“提交事务”为止，两个事务组件位置不可颠倒，也不可缺少任意一个，为固定搭配使用。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/1.%20SQL%E7%BB%84%E4%BB%B6/5-1.png)

##### 图5-1 连接好组件的流程图

b）在右侧属性栏，配置开始事务组件的名称、描述、是否开启分布式事务和事务传播行为等属性。

```
说明：

b1-1）是否开启分布式事务：开启后事务为分布式事务，分布式事务是指在分布式环境下由不同的服务之间通过网络远程协作完成事务。如果没有开启分布式事务按钮，则事务在执行到提交事务组件时才会提交所有事务。具体操作步骤可参考《SoFlu（后端）全自动开发平台教程第7.7.2节：分布式事务Seata》。

b1-2）事务传播行为：是指如果在开始当前事务之前，一个事务上下文已经存在，此时有若干选项可以指定一个事务性方法的执行行为。具体操作步骤可参考《SoFlu（后端）全自动开发平台教程第7.7.2节：事务的传播级别》。

b1-3）分布式事务超时时间：默认时间为60s，可进行自定义设置，如果在超时时间内未提交事务，则会自动进行回滚。
```

```
传播行为说明：

b2-1）REQUIRED：如果当前存在事务，则加入该事务；如果不存在事务，则创建一个新的事务。

b2-2）SUPPORTS：如果当前存在事务，则加入该事务；如果不存在事务，则无事务执行。

b2-3）MANDATORY：如果当前存在事务，则加入该事务；如果不存在事务，则抛出异常。

b2-4）REQUIRES_NEW：如果当前存在事务，则将这个事务挂起，重新创建一个新的事务。

b2-5）NOT_SUPPORTED：如果当前存在事务，则将这个事务挂起，然后无事务执行。

b2-6）NEVER：如果当前存在事务，则抛出异常。
```
