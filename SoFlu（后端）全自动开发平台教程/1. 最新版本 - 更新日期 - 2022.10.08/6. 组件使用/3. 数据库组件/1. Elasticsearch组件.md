### 6. 组件使用

#### 6.3 数据库组件

#### 6.3.1 Elasticsearch组件

Elasticsearch是一个分布式、高扩展、高实时的搜索与数据分析引擎，用户可以在平台通过Elasticsearch组件实现分布式全文搜索。

Es实现原理：首先用户将数据提交到Elasticsearch数据库中，通过分词控制器将对应的语句分词，将其权重和分词结果一并存入数据；当用户搜索数据时，再根据权重给结果排名、打分，最后将返回结果呈现给用户。

#### 6.3.1.1 前提条件

a）项目中已加载Elasticsearch组件

b）项目中已创建Elasticsearch资源实例，具体操作可参见《SoFlu（后端）全自动开发平台教程第4.15.1.12节：新增Elasticsearch资源》。

#### 6.3.1.2 步骤引导

a）使用es组件新增数据

b）使用es组件批量新增数据

c）使用es组件更新数据

d）使用es组件删除数据

e）使用es组件查询一条数据

f）使用es组件分页查询数据

g）使用es组件实现聚合查询

h）使用es组件实现分页聚合查询

#### 6.3.1.2.1 使用es组件新增数据

a）在配置接口参数处，添加需要新增数据的字段信息。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/image.png)

##### 图1-1 添加需要新增数据的字段信息

b）进入窗体视图，在左侧组件列表找到Elasticsearch组件，拖拽至中间模型编辑区。

##### 说明：若您需与其他组件搭配使用，则选择所需组件连接好组件流程图后，再进行以下Elasticsearch组件的配置即可。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-2.png)

##### 图1-2 拖拽Elasticsearch组件

c）选中Elasticsearch组件，单击选择记录方框选择Elasticsearch资源实例。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-3.png)

##### 图1-3 选择Elasticsearch资源实例

d）根据实际需求填入索引名，功能方法选择“新增数据”。

##### 说明：此处索引名相当于数据库中的表名，当Elasticsearch数据库中存在该索引名时，则会直接执行功能方法；当数据库中不存在该索引名时，会先在数据库自动新增该索引名，再执行功能方法。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-4.png)

##### 图1-4 功能方法选择“新增数据”

e）单击未选中记录方框配置参数信息，配置完成后单击确定即可。

##### 说明：当前选择入口参数为例，其它入参同理，参数字段名等于索引字段名，参数字段值等于索引字段值，若参数字段名在索引名中不存在，则会自动新增该字段名。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-5.png)

##### 图1-5 配置参数信息

#### 6.3.1.2.2 使用es组件批量新增数据

a）根据实际需求填入索引名，功能方法选择“批量新增数据”。

##### 说明：批量新增数据，即把参数里的集合的数据批量插入到索引名中。当存在该索引名时，则会直接执行功能方法，当不存在该索引名时，会先在服务中自动新增该索引名，再执行功能方法。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-6.png)

##### 图1-6 功能方法选择“批量新增数据”

b）单击未选中记录方框配置参数信息，配置完成后单击确定即可。

```
说明：

b1）当前选择入口参数为例，其它参数同理，参数字段名等于索引字段名，参数字段值等于索引字段值，如果参数字段名在索引名中不存在，则会自动新增该字段名。

b2）批量新增数据方法的入参数据类型必须为集合类型。
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-7.png)

##### 图1-7 配置参数信息

#### 6.3.1.2.3 使用es组件更新数据

a）根据需求填入索引名，功能方法选择“更新数据”。

##### 说明：更新数据功能方法相当于数据库语句的update，用于修改指定数据。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-8.png)

##### 图1-8 功能方法选择“更新数据”

b）单击未选中记录方框配置参数信息，进入填写数据页面，单击“更新内容”后的 + 按钮 填写需要更新的字段内容。

```
说明：

b1）字段名称：填写需要更新的字段名称。

b2）字段值：填写需要更新的字段值。

b3）如有多个字段，点击“+”添加。
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-9.png)

##### 图1-9 填写需要更新的字段内容

c）单击“条件”后的 +按钮 填写筛选条件，所有信息填写完成后，单击确定即可。

```
说明：

c1）es数据库会根据条件中的字段信息、查询方式、联合查询方式查询出对应的数据，然后更新内容。

c2）联合查询方式说明：

must：查询结果包含条件分词，按照条件分词匹配度排序，匹配度越高排在前面。

should: 查询结果包含条件分词，当存在多条查询条件时，只要满足任意一个条件即返回结果，按照默认排序。

filter：查询结果包含条件分词，按照默认排序。

mustNot：与must用法相反，查询出的结果不包含条件分词，按照默认排序。

c3）查询方式说明：

模糊查询：只要目标分词中有一个与查询条件的分词匹配即可，与普通的模糊查询有所区别，Elasticsearch是根据分词进行模糊查询，分词是由分词控制器将一句话自动分成若干个词语。示例：飞算科技，会划分为飞算、科技两个分词，模糊查询“飞算”能查询出飞算科技，但仅模糊查询“飞”则无法查询出飞算科技。

精确查询：只有目标分词全部与查询条件的分词相同时，才能匹配到。
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-10.png)

##### 图1-10 填写筛选条件

#### 6.3.1.2.4 使用es组件删除数据

a）根据需求填入索引名，功能方法选择“删除数据”。

##### 说明：删除数据功能方法相当于数据库语句的delete，用于删除指定数据。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-11.png)

##### 图1-11 功能方法选择“删除数据”

b）单击未选中记录方框配置参数信息，进入填写数据页面，单击“条件”后的 +按钮 填写需要删除的字段内容。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-12.png)

##### 图1-12 填写需要删除的字段内容

c）填写完成后，单击确定即可，执行接口时会根据查询结果删除对应的数据。

#### 6.3.1.2.5 使用es组件查询一条数据

a）根据需求填入索引名，功能方法选择“查询一条数据”。

##### 说明：查询一条数据功能方法相当于数据库语句的select，用于查询指定数据，但只会返回列表第一条数据。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-13.png)

##### 图1-13 功能方法选择“查询一条数据”

b）单击未选中记录方框配置参数信息，进入填写数据页面，单击“条件”后的 +按钮 填写需要查询的字段内容。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/1-14.png)

##### 图1-14 填写需要查询的字段内容
