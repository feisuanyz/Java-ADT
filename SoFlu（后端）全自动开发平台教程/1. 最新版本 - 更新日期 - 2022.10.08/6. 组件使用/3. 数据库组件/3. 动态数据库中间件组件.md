### 6. 组件使用

#### 6.3 数据库组件

#### 6.3.3 动态数据库中间件组件

动态创建数据库中间件，用于动态创建数据库连接，您可以根据需求在同一个流程图中动态创建不同的数据库连接信息，然后执行对应的SQL相关操作，无需固定数据库连接信息。动态数据库中间件需搭配对应的动态数据库中间件的资源实例使用，本章节介绍如何使用动态创建数据库连接中间件的操作步骤以及相关注意事项。

##### 说明：动态数据库资源实例操作可参考《SoFlu（后端）全自动开发平台教程第4.15.1.19节：新增动态数据库中间件资源实例》。

#### 6.3.3.1 操作步骤

a）在项目加载项页面，单击组件 > 添加动态数据库中间件组件，然后单击加载应用。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-1.png)

##### 图3-1 添加动态数据库中间件组件

b）在流程图编辑页面，拖拽出“动态数据库中间件组件”，单击选择记录。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-2.png)

##### 图3-2 单击选择记录

c）选择对应动态数据库中间件资源实例，然后单击确定。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-3.png)

##### 图3-3 选择对应动态数据库中间件资源实例

d）单击数据库连接信息的未选中记录。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-4.png)

##### 图3-4 单击数据库连接信息的未选中记录

e）填写数据库连接的基本信息，然后单击确定。

##### 说明：连接唯一标识指当前数据库连接信息的唯一标识，在同一个动态数据库资源实例下，如果标识名称和已有的标识重复，则程序会使用该标识首次创建的数据库连接信息进行连接，后填写的唯一标识的数据库连接信息则无效，若数据库连接信息不同，建议填写不同的标识名称。若数据库连接信息相同，则后续的填写唯一标识即可，数据库连接信息可以不填。

##### 注意：重启项目或者重启服务器时，数据库连接信息的唯一标识会失效，需要重新执行动态数据库中间件的接口创建数据库连接后，唯一标识才有效。需注意：唯一标识的数据库连接信息以首次创建的为准。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-5.png)

##### 图3-5 填写数据库连接的基本信息

f）单击单SQL组件 > 未选中记录。

```
注意：

f1）在流程图中，若在同一条流程分支上，不存在“动态数据库中间件组件”时，则会使用SQL组选择的中间件进行连接。若SQL组的中间件选择了“动态数据库资源”，则会使用该资源配置项defaultUniqueKey填写的唯一标识的数据库连接信息进行连接。若该字段的值为空，则无数据库连接，SQL执行失败。

f2）若在同一条流程分支上，存在“动态数据库中间件组件”时，则会使用该组件的唯一标识的数据库连接信息进行连接，该资源的配置项defaultUniqueKey填写的连接标识无效。
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-6.png)

##### 图3-6 单击未选中记录

g）选择对应的SQL，然后单击确定。

##### 说明：若在同一条流程分支上，存在“动态数据库中间件组件”时，只能选择SQL组选择的中间件资源和动态数据库中间件组件选择的资源一致的，才能选择对应的SQL信息。若两者中间件选择的资源不一致，则不能选择该SQL组下的SQL信息，以动态数据库中间件选择的资源为准。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-7.png)

##### 图3-7 选择对应的SQL

h）保存并发布接口，然后执行测试用例，动态创建数据库成功。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/3.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6/3-8.png)

##### 图3-8 执行测试用例
