### 6. 组件使用

#### 6.9 通信组件

#### 6.9.4 客户端通信组件

客户端通信组件主要用于支持WebSocket协议，实现服务端主动向客户端推送消息。

本节将通过具体案例来介绍如何利用客户端通信组件实现消息的主动推送。

##### 说明：WebSocket协议是一种在单个TCP连接上进行全双工通信的协议，它允许服务端主动向客户端推送数据，客户端和服务端只需要完成一次握手，两者之间就可以创建持久性的连接并双向传输数据，这使得客户端和服务端之间的数据交换变得更加简单。

#### 6.9.4.1 前提条件

项目中已加载客户端通信组件。

#### 6.9.4.2 操作步骤

##### 本节使用一个简单的计时器案例进行说明。

a）进入平台接口管理功能模块，新增一个接口，接口协议选择WebSocket，单击下一步。

![image](https://user-images.githubusercontent.com/79617492/210334814-00ad3587-a8f9-4523-9648-f4f9bc08be4d.png)

##### 图4-1 接口协议选择WebSocket

b）根据实际开发需求配置接口的入口参数，示例中配置了整型变量a作为计数变量，参数配置完成后，提交参数信息。

![image](https://user-images.githubusercontent.com/79617492/210334879-6910a2d9-ba49-4af9-845f-662a3582a264.png)

##### 图4-2 配置接口的入口参数

c）进入模型编辑界面，连接好接口流程图，如下图所示。

![image](https://user-images.githubusercontent.com/79617492/210335456-13ef3ab5-38f4-42cd-baab-885a0f6afac4.png)

##### 图4-3 连接好接口流程图

##### 说明：客户端通信组件若放置于循环体内，则会一直推送消息给客户端，直到循环结束；若客户端通信组件不在循环内，则只会推送一次。

d）选中客户端通信组件，录入客户端编号。

![image](https://user-images.githubusercontent.com/79617492/210335472-1349784b-e371-45ec-8e05-9e72630e15ab.png)

##### 图4-4 录入客户端编号

e）选择流程变量，双击选择接口参数wsSessionld即可。

![image](https://user-images.githubusercontent.com/79617492/210335489-52886955-5a08-47d0-a521-7b820f270f38.png)

##### 图4-5 双击选择接口参数wsSessionld

##### 说明：WebSocket协议接口会自动生成textMessage(默认文本消息字段)、binaryMessage(默认字节消息字段)、wsSessionId(websocket客户端编号)参数信息。

f）选择录入需推送给客户端的消息内容。

![image](https://user-images.githubusercontent.com/79617492/210335511-5e429ca3-9076-46f0-9079-ebf80cb4375f.png)

##### 图4-6 点击录入参数

![image](https://user-images.githubusercontent.com/79617492/210335535-337c4001-275a-468b-86ba-ddd8f968eace.png)

##### 图4-7 录入需推送给客户端的消息内容

##### 说明：示例选择的消息内容为当前计数器索引值，每循环一次传给客户端一次，您可以根据实际开发需求自行设置。

g）完成websocket协议接口流程图编辑，保存发布接口。

h）与前端做好联调，请求接口后，客户端会显示当前计数器不同的数值，以实现倒计时的效果，如下图所示。

![image](https://user-images.githubusercontent.com/79617492/210335563-d05277dd-0599-4e35-bf9f-5af09f46e80b.png)

##### 图4-8 倒计时效果
