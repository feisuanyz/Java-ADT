### 6. 组件使用

#### 6.9 通信组件

#### 6.9.6 MQTT客户端消息发布组件

平台系统支持MQTT功能，用户可通过新增MQTT客户端资源实例，然后使用MQTT客户端消息发布组件来发布主题和消息，最后通过MQTT模型的接口来订阅主题和接收消息。

#### 6.9.6.1 操作步骤

a）在项目加载项页面，单击组件 > 添加MQTT客户端消息发布组件，然后单击加载应用。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/9.%20%E9%80%9A%E4%BF%A1%E7%BB%84%E4%BB%B6/6-1.png)

##### 图6-1 单击加载应用

b）新增接口，进行流程图编辑，选中MQTT客户端消息发布组件，单击未选中记录。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/9.%20%E9%80%9A%E4%BF%A1%E7%BB%84%E4%BB%B6/6-2.png)

##### 图6-2 单击未选中记录

c）填写对应数据信息，然后单击确定。

```
字段说明：

c1）主题：自定义发布的主题。

c2）消息体：该主题对应的消息体内容。

c3）服务质量：

c3-1）Qos 0：消息至多传一次，也可不传，也就是该客户端会给服务器最多发送一次消息，或者不发送，但不会有重复消息。

c3-2）Qos 1：消息至少传一次，可以多次，但会重复。也就是该客户端最少会给服务器发送一次消息，或者多几次，消息内容就会重复。

c3-3）Qos 2：消息刚好一次，必须发送，只能发送一次。也就是该客户端会给服务器一条消息，不会不发和多发。

是否保留消息：开启按钮后，MQTT客户端向服务器发布该主题的消息时，则该消息将被永久保存在服务器上，如果没有开启，则消息不会保留。
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/9.%20%E9%80%9A%E4%BF%A1%E7%BB%84%E4%BB%B6/6-3.png)

##### 图6-3 填写对应数据信息

d）发布接口，然后执行接口测试用例。

##### 说明：执行接口时，MQTT客户端消息发布组件就会往MQTT服务器发布该主题和消息。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/6.%20%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8/9.%20%E9%80%9A%E4%BF%A1%E7%BB%84%E4%BB%B6/6-4.png)

##### 图6-4 执行接口测试用例
