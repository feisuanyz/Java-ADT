### 7. 进阶指南

#### 7.1 微服务治理

#### 7.1.1 集成Etcd注册中心

Etcd是CoreOs团队发起的开源项目，是一个管理配置信息和服务发现（service discovery）的项目，它的目标是构建一个高可用的分布式键值（key-value）数据库，主要的特点是简单，安全，快速，可靠。

##### 说明：后端全自动开发平台中的项目需通过使用本地客户端或部署项目的方式进行配置，才可在Etcd注册中心注册并使用Etcd注册中心的服务，未进行配置注册的项目不可以使用Etcd注册中心的服务。使用本地客户端和部署项目的详细操作请参见《SoFlu（后端）全自动开发平台教程第2.1节：安装本地客户端》和《SoFlu（后端）全自动开发平台教程第2.9.1节：如何部署项目》。

#### 7.1.1.1 步骤引导

a）配置注册Etcd

b）使用Etcd服务

#### 7.1.1.1.1 配置注册Etcd

a）访问Etcd官网下载Etcd的最新版本，解压后启动Etcd。

b）在使用本地客户端或部署项目时打开bootstrap.yml配置文件，在文件中增加如下配置：

```
etcd:  
    enabled: true 
uri: http://127.0.0.1:8080,http://127.0.0.1:8081 # Etcd服务节点，多个服务使用逗号分隔
```

```
说明：

b1）若无bootstrap.yml文件，请手动创建。

b2）注册中心注册优先级为：Nacos >> Consul >> Eureka >> Etcd，使用Etcd服务时请确保优先级更高注册中心的开关为false，如下图所示。
```

![image](https://user-images.githubusercontent.com/79617492/210524279-f40a2338-5567-46e2-b45c-830a732414f4.png)

##### 图1-1 确保优先级更高注册中心的开关为false

c）若通过本地客户端进行配置，双击startup.bat启动服务同时确保需注册项目在平台中属于启动状态，对应项目即可在Etcd注册中心注册成功；若通过部署项目的方式进行配置，则只需要双击startup.bat启动服务即可。

![image](https://user-images.githubusercontent.com/79617492/210524301-3876fe67-675e-4a3a-aec6-34d3b98ba708.png)

##### 图1-2 双击startup.bat启动服务

##### 配置注册好Etcd之后，便可在已注册项目中使用Etcd服务。

#### 7.1.1.1.2 使用Etcd服务

##### 说明：使用Etcd服务与使用Consul服务类似。

a）进入（后端）全自动开发平台，为已注册项目添加Etcd配置资源和FeignClient组件。

![image](https://user-images.githubusercontent.com/79617492/210524316-81ada806-3435-4ae3-b0c9-55498b942627.png)

##### 图1-3 添加Etcd配置资源

![image](https://user-images.githubusercontent.com/79617492/210524342-cfe3ed05-b69c-4d7d-9852-d2709bef421f.png)

##### 图1-4 添加FeignClient组件

b）新增Etcd配置资源实例，填写好相关信息，host填写Etcd部署的服务节点，单击“提交”即可。

![image](https://user-images.githubusercontent.com/79617492/210524359-2cc682a2-134c-4042-bf1d-d44e208cd82d.png)

##### 图1-5 填写相关信息

c）创建接口，进行接口流程图编辑。

![image](https://user-images.githubusercontent.com/79617492/210524383-d724394f-1718-4da9-be2f-8b199ef61249.png)

##### 图1-6 进行接口流程图编辑

d）选中FeignClient组件，注册中心类型选择etcd注册中心，注册中心资源选择新增的etcd配置资源实例。

![image](https://user-images.githubusercontent.com/79617492/210524409-c2b4eb4a-5ddf-402e-b625-e7a68b6d8367.png)

##### 图1-7 注册中心类型选择etcd注册中心

e）自定义配置http请求参数。

![image](https://user-images.githubusercontent.com/79617492/210524433-4344e9cb-5149-4106-ac89-f3604fdd63a1.png)

##### 图1-8 自定义配置http请求参数

f）配置好输出结果组件，单击“保存并退出”。

![image](https://user-images.githubusercontent.com/79617492/210524446-d1c38c6e-3313-421c-be7b-33804e1cf0c8.png)

##### 图1-9 配置好输出结果组件

g）执行测试用例，看到接口能正常访问即可。

![image](https://user-images.githubusercontent.com/79617492/210524460-fa350db7-643b-4151-a156-8951d73ab8af.png)

##### 图1-10 执行测试用例
