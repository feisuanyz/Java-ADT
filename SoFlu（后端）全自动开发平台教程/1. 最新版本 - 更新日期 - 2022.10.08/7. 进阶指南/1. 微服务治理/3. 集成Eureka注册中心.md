### 7. 进阶指南

#### 7.1 微服务治理

#### 7.1.3 集成Eureka注册中心

Eureka是Netflix开发的服务发现组件，本身是一个基于REST的服务，Spring Cloud将它集成在其子项目Spring-cloud-netflix中，以实现Spring Cloud的服务注册与发现，同时还提供了负载均衡、故障转移等能力。本节为您介绍如何在（后端）全自动开发平台使用Eureka注册中心的服务。

##### 说明：（后端）全自动开发平台中的项目需通过使用本地客户端或部署项目的方式进行配置，才可在Consule注册中心注册并使用Consule注册中心的服务，未进行配置注册的项目不可以使用Consul注册中心的服务。使用本地客户端和部署项目的详细操作请参见《SoFlu（后端）全自动开发平台教程第2.1节：注册账户》和《SoFlu（后端）全自动开发平台教程第2.9.1节：如何部署项目》。

#### 7.1.3.1 步骤引导

a）配置注册Eureka

b）使用Eureka服务

#### 7.1.3.1.1 配置注册Eureka

a）访问Eureka官网下载Eureka的最新版本，下载解压后，启动服务。

b）在使用本地客户端或部署项目时打开bootstrap.yml配置文件，在文件中增加如下配置：

```
eureka:  
  		instance:    
    		hostname: feisuanyz  
  		client:  
    		enabled: true
          serviceUrl: 
                defaultZone: http://127.0.0.1:8080/eureka
```

![image](https://user-images.githubusercontent.com/79617492/210750220-1164a0e9-67a1-4136-9132-d78e23c08388.png)

##### 图3-1 增加的配置内容

```
说明：

b1）若无bootstrap.yml文件，请手动创建。

b2）注册中心注册优先级为：Nacos >> Consul >> Eureka >> Etcd，使用Etcd服务时请确保优先级更高注册中心的开关（即Nacos、Consul注册中心开关）为false。
```

c）若通过本地客户端进行配置，双击startup.bat启动服务同时确保需注册项目在平台中属于启动状态，对应项目即可在Eureka注册中心注册成功；若通过部署项目的方式进行配置，则只需要双击startup.bat启动服务即可。

![image](https://user-images.githubusercontent.com/79617492/210750241-ad6f63f0-dcad-4ffb-a855-cb237f89ed5e.png)

##### 图3-2 双击startup.bat启动服务

##### 配置注册好Eureka之后，便可在已注册项目中使用Eureka服务。

#### 7.1.3.1.2 使用Eureka服务

a）添加Eureka配置资源、HTTP通信及FeignClient组件。

![image](https://user-images.githubusercontent.com/79617492/210750526-d7e9d1ef-ab6e-416f-96b5-a8bae0260fc0.png)

##### 图3-3 添加Eureka配置资源

![image](https://user-images.githubusercontent.com/79617492/210750543-2ef8d1d0-d816-4266-ae84-0ea7b63bc164.png)

##### 图3-4 添加HTTP通信及FeignClient组件

b）新增Eureka配置资源实例

填写好相关信息，host填写Eureka部署的服务节点，单击“提交”即可。

![image](https://user-images.githubusercontent.com/79617492/210750590-69d96839-a55b-4575-a7ff-acbb264e4778.png)

##### 图3-5 host填写Eureka部署的服务节点

c）新增HTTP通信资源实例

填写好相关信息，url填写需要调用接口的路径，填写完成后单击“提交”即可。

![image](https://user-images.githubusercontent.com/79617492/210750608-5a7a99d6-8331-48ef-a716-a3e83b33b83d.png)

##### 图3-6 url填写需要调用接口的路径

d）创建接口，进行接口流程图编辑

##### 说明：为便于演示，示例中仅用到了FeignClient组件和输出结果组件。

d1）选中FeignClient组件，注册中心类型选择eureka注册中心，注册中心资源选择新增的Eureka配置资源实例。

![image](https://user-images.githubusercontent.com/79617492/210750634-57575ec7-b36d-425e-a931-53f7b6641fad.png)

##### 图3-7 选择eureka注册中心

![image](https://user-images.githubusercontent.com/79617492/210750662-4a14390b-4233-4708-8815-6284ef9f336c.png)

##### 图3-8 选择新增的Eureka配置资源实例

d2）自定义配置http请求参数，HTTP通信资源选择新增的HTTP通信资源实例。

![image](https://user-images.githubusercontent.com/79617492/210750695-9cf3e5f7-0e7d-4011-b448-39ab00f9a0e3.png)

##### 图3-9 选择新增的HTTP通信资源实例

![image](https://user-images.githubusercontent.com/79617492/210750718-f3ccd850-691d-40e1-97ee-ebc6f26bd9ee.png)

##### 图3-10 填写数据

d3）配置好输出结果组件，完成后单击“保存并退出”即可。

![image](https://user-images.githubusercontent.com/79617492/210750736-db67e1c1-07e0-428d-8ecb-6bc5b07ba72f.png)

##### 图3-11 配置好输出结果组件

e）执行测试用例

提交发布接口后，对接口执行测试用例，看到接口能正常访问即可。

![image](https://user-images.githubusercontent.com/79617492/210750761-af1672a8-a1cd-4ee6-ac5a-107bb95d5b27.png)

##### 图3-12 对接口执行测试用例
