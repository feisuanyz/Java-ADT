### 7. 进阶指南

#### 7.1 微服务治理

#### 7.1.5 通过Apollo修改配置信息

##### Apollo（阿波罗）是携程开源的分布式配置中心，能够集中化管理应用不同环境、不同集群的配置，支持修改配置后实时推送到应用端，并具备规范的权限及流程治理等特性。

全自动开发平台支持对接Apollo配置中心，用户在Apollo配置中修改资源实例或配置组等相关配置信息后，配置信息将实时生效或者重启服务后生效，无需再重新部署项目。本节将为您介绍如何通过Apollo修改配置信息，该功能目前只支持执行引擎离线模式。

#### 7.1.5.1 步骤一：Apollo服务配置

更详细的apollo使用说明请参考：https://github.com/apolloconfig/apollo/wiki/Apollo开放平台

a）搭建Apollo服务，建议参考官网搭建教程后，自行搭建。

b）登录Apollo配置中心，浏览器打开apollo-portal地址即可。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-1.png)

##### 图5-1 登录Apollo配置中心

c）单击“创建项目”，进入创建项目页面。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-2.png)

##### 图5-2 单击“创建项目”

d）根据需求填写字段信息后，单击“提交”，创建项目成功。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-3.png)

##### 图5-3 单击“提交”

e）单击右上角菜单“管理员工具 > 开放平台授权管理”，进入创建第三方应用页面。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-4.png)

##### 图5-4 单击“开放平台授权管理”

f）填写第三方应用创建信息，单击“创建”。

##### 说明：第三方负责人要向apollo管理员提供第三方应用的基本信息，创建前要先点击查询，查看这个第三方应用ID是否被创建，创建成功后会生成一个token值。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-5.png)

##### 图5-5 填写第三方应用创建信息

g）创建成功，获取到token。

##### 说明：第三方应用不能操作任何Namespace的配置，所以要给token绑定可以操作的Namespace,在步骤8进行赋权，赋权之后，第三方应用就可以通过apollo来管理已授权的Namespace配置。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-6.png)

##### 图5-6 获取到token

h）填写赋权字段下的所有信息。

```
字段说明：

h1）被管理的Appid：步骤4所填写的应用id

h2）被管理的Namespace：针对需要单独控制的配置文件，填写配置文件名称，未填写则默认所有

h3）授权类型：Namespace只能修改和发布配置文件信息，APP能够创建、修改和发布配置文件信息
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-7.png)

##### 图5-7 填写赋权字段下的所有信息

i）单击“提交”，第三方应用赋权成功。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-8.png)

##### 图5-8 单击“提交”

#### 7.1.5.2 步骤二：在Apollo配置中心修改配置信息

a）在启动项目的配置文件bootstrap.yml中增加以下配置，若无此文件，新增即可。

```
apollo:  
    enabled: true   # 是否开启Apollo  
    meta: http://172.16.147.185:8080  # apollo-config-service地址  
    portalUrl: http://172.16.147.187:8080   # apollo-portal地址  
    token: 87c03d769e678faba33af97fbcdf580853726031   # Apollo的项目授权的token  
    user: apollo    # Apollo的用户名  
    env: DEV    # Apollo环境   
    cluster: default    # 集群名称，在apollo中可新建集群，填写对应名称即可
app:  
    id: ceshi  # Apollo项目名
```

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-9.png)

##### 图5-9 增加的配置内容

##### meta地址查看方式：单击apollo系统右上角的“管理员工具 > 系统信息”， bootstrap.yml配置文件中env选择什么环境就填写对应meta server其中之一即可。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-10.png)

##### 图5-10 单击“系统信息”

b）启动项目。

![输入图片说明](../../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/7.%20%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/1.%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86/5-11.png)

##### 图5-11 启动项目
