### 8. 高阶专题

#### 8.4 自定义组件

开发一个组件必须要遵循必要的规范，比如：实现统一的接口、符合SPI机制，本节将详细介绍如何自定义组件。

#### 8.4.1 前提条件

自定义组件需要下载如下Demo工程包和加载项开发包，具体如下：

a）组件Demo工程包下载地址：demo-component.zip

b）下载加载项开发包：在(后端)全自动开发平台中，单击右上角下载加载项开发包，如图4-1所示。

![输入图片说明](../../../images/SoFlu%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/1.%20%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%20-%20%E6%9B%B4%E6%96%B0%E6%97%A5%E6%9C%9F%20-%202022.10.08/8.%20%E9%AB%98%E9%98%B6%E4%B8%93%E9%A2%98/4-1.png)

##### 图4-1 下载加载项开发包

#### 8.4.2 操作步骤

a）编辑pom.xml文件，在pom.xml文件中增加依赖包。

包名：com.feisuanyz.flow.component.FlowComponent

类名：FlowComponent

正确的示例如下：

```
<dependency>
     <groupId>com.feisuanyz.flow</groupId>
     <artifactId>flow-core-cmpt</artifactId>
     <version>${version}</version>
     <scope>provided</scope>
     <systemPath>${开发辅助工具路径}/flow-core-cmpt-${version}.jar</systemPath>
</dependency>
```

b）开发实现FlowComponent接口。

包名：com.feisuanyz.flow.component.FlowComponent

类名：FlowComponent

实现方法：

```
/**
 * 执行组件
 * @param parameter 组件参数
 * @throws FlowComponentException 异常
 */
void execute(FlowComponentParameter parameter) throws FlowComponentException
```

c）获取入参。

##### 说明：入参是指能够传入到组件的参数内容，组件中能够使用的参数都必须在定义组件的时候定义入参，数据类型必须要和实际传入的数据类型相符，否则将会抛出FlowComponentException异常。

下面介绍获取参数的方式：

c1）获取单条记录的参数值

parameter.getInputParameter("parameterName",类型);

c2）获取多条记录的参数值

parameter.getInputParameterArray("parameterName",类型);

d）设置出参。

##### 说明：出参是指流转到下一个组件的参数内容，所有的输出都必须在定义组件的时候定义出参，数据类型必须要和实际传出的数据类型相符，否则将会抛出FlowComponentException异常。

下面介绍设置出参的方式：

parameter.setOutputParameter("parameterName",value);

##### 说明：如果出参定义了默认值，又没有对输出参数进行赋值，则程序会自动将默认值赋到出参。

e）定义方式。

组件的定义需要按照以下xml格式进行描述，文件名必须为：components.xml，然后存放到项目中的resources目录下，一起打成jar包上传到平台即可。

XML文件示例如下：

```
<?xml version="1.0" encoding="UTF-8"?>

<components>
    <component name="SingleSqlComponent"
               title="单SQL组件"
 implClass="com.feisuanyz.flow.component.sql.SingleSqlComponent"
               tag="sql"
               description="单SQL组件"
               groupName="SQL"
               icon="SingleSqlComponent">
        <inputParameters>
            <inputParameter name="sqlDto"
                            title="SQL信息"
           dataType="com.feisuanyz.flow.component.sql.dto.SqlDTO"
                            controlType="form-single-value"
                            required="true"
                            hided="false"
                            description="填入SQL信息">
                <children>
                    <inputParameter name="sqlName"
                                    title="SQL名称"
                                    dataType="java.lang.String"
                                    controlType="Table"          optionImplClass="com.feisuanyz.flow.component.sql.SelectAllSqlTableControl"
                                    required="true"
                                    description="被执行的SQL的名称"/>
                    <inputParameter name="inputParameter"
                                    title="入参"
                                    dataType="java.lang.Object"
                                    controlType="Input"
                                    required="true"
                                    variable="true"
                                    description="执行SQL传入的参数，支持表达式${xxx}"/>
                    <inputParameter name="primaryKey"
                                    title="主键名称"
                                    dataType="java.lang.String"
                                    controlType="Input"
                                    description="表的主键名称，新增时必填"/>
                </children>
            </inputParameter>

            <inputParameter name="isList"
                            title="执行结果是否为列表"
                            dataType="java.lang.Boolean"
                            controlType="Switch"
                            defaultValue="false"
                            required="true"
                            description="执行结果是否为列表"/>

        </inputParameters>
        <!-- 定义出参列表 -->
        <outputParameters>
            <outputParameter name="singleSqlExecuteResult"
                             title="单SQL执行结果"
                             dataType="java.lang.Object"
                             required="true"
                             description="单SQL执行结果"/>
        </outputParameters>
    </component>

</components>

```
